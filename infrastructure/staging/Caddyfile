# Nullspace Testnet Staging - Caddy Reverse Proxy
# Domain: regenesis.dev
# Automatic HTTPS via Let's Encrypt

# Main website
testnet.regenesis.dev {
    reverse_proxy nullspace-website:80

    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        Referrer-Policy "strict-origin-when-cross-origin"
    }

    log {
        output file /var/log/caddy/website.log
        format json
    }
}

# Auth service
auth.testnet.regenesis.dev {
    reverse_proxy nullspace-auth:4000

    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        Access-Control-Allow-Origin "*"
        Access-Control-Allow-Methods "GET, POST, OPTIONS"
        Access-Control-Allow-Headers "Content-Type, Authorization"
    }

    log {
        output file /var/log/caddy/auth.log
        format json
    }
}

# Gateway (WebSocket + HTTP API)
api.testnet.regenesis.dev {
    reverse_proxy nullspace-gateway:9010

    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        Access-Control-Allow-Origin "*"
        Access-Control-Allow-Methods "GET, POST, OPTIONS"
        Access-Control-Allow-Headers "Content-Type, Authorization"
    }

    log {
        output file /var/log/caddy/gateway.log
        format json
    }
}

# Indexer/Simulator API
indexer.testnet.regenesis.dev {
    reverse_proxy nullspace-simulator:8080

    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        Access-Control-Allow-Origin "*"
        Access-Control-Allow-Methods "GET, POST, OPTIONS"
        Access-Control-Allow-Headers "Content-Type, Authorization"
    }

    log {
        output file /var/log/caddy/indexer.log
        format json
    }
}

# Health check endpoint (internal)
:8080 {
    respond /health "OK" 200
}
