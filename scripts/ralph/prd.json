{
	"branchName": "ralph/testnet-production",
	"userStories": [
		{
			"id": "US-021",
			"title": "Add golden vectors for state parsing (server→client)",
			"acceptanceCriteria": [
				"Add golden vectors for parseBlackjackState, parseHiLoState, etc. to golden-vectors.json",
				"Include vectors for all 10 game types with real server state bytes",
				"Test vectors cover edge cases: empty hands, max cards, boundary totals",
				"Mobile tests import and validate against these vectors"
			],
			"priority": 1,
			"passes": true,
			"notes": "ROOT CAUSE: Current golden-vectors.json only has encoding vectors (client→server). No vectors exist for parsing server state, which is where the blackjack crash occurred."
		},
		{
			"id": "US-022",
			"title": "Replace mocked state parsers with real implementations in unit tests",
			"acceptanceCriteria": [
				"Remove jest.mock for parseBlackjackState and similar parsers",
				"Use real parseXxxState functions with golden vector byte arrays",
				"Test card decoding, Ace total calculation, phase mapping",
				"Verify bitwise action mask logic (canDouble, canSplit)"
			],
			"priority": 2,
			"passes": true,
			"notes": "FIXED: Deleted global mock at mobile/__mocks__/@nullspace/game-state.js. BlackjackScreen.test.tsx now uses real parsers with stateFixtures. Tests verify stage, actionMask, phase mapping, canDouble, canSplit. All 226 tests pass."
		},
		{
			"id": "US-023",
			"title": "Fix blocking haptics pattern across all game screens",
			"acceptanceCriteria": [
				"Audit all game screens for 'await haptics.xxx()' patterns",
				"Convert to fire-and-forget: 'haptics.xxx().catch(() => {})'",
				"No remaining blocking haptic calls in production code",
				"Add lint rule to prevent future blocking haptic calls"
			],
			"priority": 3,
			"passes": false,
			"notes": "VERIFIED BUG: 22 blocking haptics calls fixed across 9 game screens. Need verification test passes."
		},
		{
			"id": "US-024",
			"title": "Add protocol round-trip tests for mobile state decoders",
			"acceptanceCriteria": [
				"Create tests that: TypeScript encodes → Rust processes → TypeScript decodes",
				"Verify decoded state matches expected values after processing",
				"Cover all game types: blackjack, roulette, craps, baccarat, sic_bo, hilo, etc.",
				"Run as part of CI to catch protocol drift"
			],
			"priority": 4,
			"passes": false,
			"notes": "VERIFIED GAP: Rust has protocol_round_trip_tests.rs but only validates Rust-side parsing. No test validates TypeScript can decode what Rust produces."
		},
		{
			"id": "US-025",
			"title": "Add storage fallback integration tests",
			"acceptanceCriteria": [
				"Test MMKV → AsyncStorage fallback behavior in Expo Go",
				"Test storage initialization error handling",
				"Test tutorial state persistence across app restarts",
				"Test encryption key generation failures"
			],
			"priority": 5,
			"passes": false,
			"notes": "VERIFIED GAP: Storage service mock always succeeds. Real code has 3 backends (MMKV, AsyncStorage, WebStorage) that are never tested."
		},
		{
			"id": "US-026",
			"title": "Add WebSocket reconnection integration tests",
			"acceptanceCriteria": [
				"Test session persistence after reconnect",
				"Test game state recovery after mid-game disconnect",
				"Test nonce continuity after reconnection",
				"Test balance consistency after network failure"
			],
			"priority": 6,
			"passes": false,
			"notes": "VERIFIED GAP: useGameConnection is completely mocked in unit tests. Real reconnection logic never exercised."
		},
		{
			"id": "US-027",
			"title": "Fix mobile integration test message type mismatches",
			"acceptanceCriteria": [
				"All 10 game integration tests pass against local gateway",
				"Fix game_started vs game_result message type expectations",
				"Update waitForGameOutcome to handle all message types",
				"Add timeout with diagnostic info on failure"
			],
			"priority": 7,
			"passes": false,
			"notes": "FIXED: 4 atomic games (Roulette, Craps, Baccarat, SicBo) - removed game_started expectation. 1 hybrid game (CasinoWar) - check game_started for embedded results. 2 multi-move games (ThreeCard, UltimateHoldem) - already correct. 3 games (HiLo, Blackjack, VideoPoker) - untested, need gateway running. Pending: run integration tests against live gateway."
		},
		{
			"id": "US-028",
			"title": "Add chip betting balance validation tests",
			"acceptanceCriteria": [
				"Test placeChip() returns false when bet exceeds balance",
				"Test haptics.error() is called on failed chip placement",
				"Test UI disables bet buttons when balance exhausted",
				"Use real useChipBetting hook with controlled gameStore"
			],
			"priority": 8,
			"passes": false,
			"notes": "VERIFIED GAP: mockUseChipBetting always returns placeChip: true. Over-betting scenarios never tested."
		},
		{
			"id": "US-029",
			"title": "Add corrupted protocol data tests",
			"acceptanceCriteria": [
				"Test decoder handles truncated messages gracefully",
				"Test decoder handles extra bytes after valid data",
				"Test decoder handles varint overflow",
				"Test decoder handles invalid UTF-8 in string fields"
			],
			"priority": 9,
			"passes": false,
			"notes": "VERIFIED GAP: No negative tests for deliberately corrupted binary data in protocol tests."
		},
		{
			"id": "US-030",
			"title": "Add crypto signing integration tests",
			"acceptanceCriteria": [
				"Test real Ed25519 signature generation (not mocked)",
				"Test signature verification round-trip",
				"Test vault key export/import functionality",
				"Remove jest.mock for @noble/curves/ed25519"
			],
			"priority": 10,
			"passes": false,
			"notes": "VERIFIED GAP: Mobile crypto.test.ts mocks all ed25519 operations. Real signing never validated."
		},
		{
			"id": "US-010",
			"title": "Execute soak test",
			"acceptanceCriteria": [
				"./scripts/soak-test.sh configs/testnet 4",
				"DURATION_SECONDS=600 (10 minutes)",
				"No crashes or deadlocks",
				"Memory usage stable"
			],
			"priority": 11,
			"passes": false,
			"notes": "MANUAL: Script exists at scripts/soak-test.sh, needs staging deployment"
		},
		{
			"id": "US-011",
			"title": "Execute bot load test",
			"acceptanceCriteria": [
				"./scripts/run-bots.sh configs/testnet http://<HOST>:8080",
				"NUM_BOTS=300 DURATION_SECONDS=300",
				"No sustained errors",
				"Response times acceptable"
			],
			"priority": 12,
			"passes": false,
			"notes": "MANUAL: Script exists at scripts/run-bots.sh, needs staging deployment"
		},
		{
			"id": "US-012",
			"title": "Execute global table fanout test",
			"acceptanceCriteria": [
				"node scripts/load-test-global-table.mjs",
				"URL=ws://<GATEWAY>:9010 TOTAL=5000 DURATION=300",
				"Events broadcast to all clients",
				"No message loss"
			],
			"priority": 13,
			"passes": false,
			"notes": "MANUAL: Script exists at scripts/load-test-global-table.mjs, needs staging"
		},
		{
			"id": "US-013",
			"title": "Verify health endpoints",
			"acceptanceCriteria": [
				"GET http://<INDEXER>:8080/healthz returns 200",
				"GET http://<GATEWAY>:9010/healthz returns 200",
				"All services respond within 5s"
			],
			"priority": 14,
			"passes": false,
			"notes": "MANUAL: Basic smoke check per runbook, needs staging deployment"
		},
		{
			"id": "US-014",
			"title": "Test faucet flow end-to-end",
			"acceptanceCriteria": [
				"Register new user via mobile app",
				"Claim faucet credits",
				"Balance updates correctly",
				"Can place and resolve bet"
			],
			"priority": 15,
			"passes": false,
			"notes": "MANUAL: Core testnet user journey on staging"
		},
		{
			"id": "US-015",
			"title": "Test vault-only login on iOS",
			"acceptanceCriteria": [
				"Set VITE_ALLOW_LEGACY_KEYS=0",
				"Create new account with vault password",
				"Export recovery key",
				"Reimport on fresh install"
			],
			"priority": 16,
			"passes": false,
			"notes": "MANUAL: Go/No-Go criteria per runbook Section 10"
		},
		{
			"id": "US-016",
			"title": "Test vault-only login on Android",
			"acceptanceCriteria": [
				"Set VITE_ALLOW_LEGACY_KEYS=0",
				"Create new account with vault password",
				"Export recovery key",
				"Reimport on fresh install"
			],
			"priority": 17,
			"passes": false,
			"notes": "MANUAL: Go/No-Go criteria per runbook Section 10"
		},
		{
			"id": "US-017",
			"title": "Test validator restart recovery",
			"acceptanceCriteria": [
				"Stop one validator node",
				"Restart after 30 seconds",
				"Node rejoins consensus",
				"No transaction loss"
			],
			"priority": 18,
			"passes": false,
			"notes": "MANUAL: Recovery drill per runbook Section 7"
		},
		{
			"id": "US-018",
			"title": "Test gateway restart recovery",
			"acceptanceCriteria": [
				"Stop gateway service",
				"Restart after 10 seconds",
				"Sessions re-register",
				"Nonces persist correctly"
			],
			"priority": 19,
			"passes": false,
			"notes": "MANUAL: Recovery drill per runbook Section 7"
		},
		{
			"id": "US-019",
			"title": "Build production mobile APK",
			"acceptanceCriteria": [
				"Configure EAS secrets for production endpoints",
				"eas build -p android --profile production",
				"Install on real device",
				"Verify WSS connection works"
			],
			"priority": 20,
			"passes": false,
			"notes": "MANUAL: Final production Android build"
		},
		{
			"id": "US-020",
			"title": "Build production mobile IPA",
			"acceptanceCriteria": [
				"Configure EAS secrets for production endpoints",
				"eas build -p ios --profile production",
				"Install via TestFlight",
				"Verify WSS connection works"
			],
			"priority": 21,
			"passes": false,
			"notes": "MANUAL: Final production iOS build"
		}
	]
}
