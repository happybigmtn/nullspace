const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BorrowPanel-DMKTyuTk.js","assets/index-mFzF45K3.js","assets/index-CIN8irXV.css","assets/LiquidityPanel-BKeBNJhV.js","assets/useActivityFeed-BE_j7v_U.js","assets/txTracker-BOjY1mwg.js"])))=>i.map(i=>d[i]);
import{a as c,j as e,u as Ve,p as H,t as j,W as Ie,L as fe,P as qe,N as le,_ as Ne}from"./index-mFzF45K3.js";import{t as Ue,a as U,P as Ge,l as Ae,b as Pe}from"./txTracker-BOjY1mwg.js";import{p as $,C as $e,u as Oe}from"./useActivityFeed-BE_j7v_U.js";import{u as Fe}from"./CasinoConnectionContext-fVNBG02E.js";function Ye(d,S,N){if(!d)return{out:0n,fee:0n,burned:0n};if(typeof S!="bigint"||S<=0n)return{out:0n,fee:0n,burned:0n};const w=BigInt(d.reserveRng??0),k=BigInt(d.reserveVusdt??0),T=BigInt(d.feeBasisPoints??0),C=BigInt(d.sellTaxBasisPoints??0);if(w<=0n||k<=0n)return{out:0n,fee:0n,burned:0n};let _=0n,a=S,u=k,G=w;if(!N&&(u=w,G=k,_=S*C/10000n,a=S-_,a<=0n))return{out:0n,fee:0n,burned:_};const E=a*T/10000n,i=a-E;if(i<=0n)return{out:0n,fee:E,burned:_};const O=u+i;return O<=0n?{out:0n,fee:E,burned:_}:{out:i*G/O,fee:E,burned:_}}function Ke(d,S){const N=typeof d=="bigint"&&d>0n?d:0n,w=Number.isFinite(S)?Math.max(0,Math.min(1e4,Math.floor(S))):0;return N*BigInt(1e4-w)/10000n}const ze=({amm:d,ammDerived:S,player:N,swapDirection:w,slippageBps:k,swapAmountIn:T,setSwapDirection:C,setSlippageBps:_,setSwapAmountIn:a,onSubmitSwap:u})=>{const[G,E]=c.useState(!1),[i,O]=c.useState(!1),[f,se]=c.useState(T);c.useEffect(()=>{const h=window.setTimeout(()=>se(T),200);return()=>window.clearTimeout(h)},[T]);const B=w==="BUY_RNG"?"vUSDT":"RNG",M=c.useMemo(()=>BigInt(w==="BUY_RNG"?(N==null?void 0:N.vusdtBalance)??0:(N==null?void 0:N.chips)??0),[N==null?void 0:N.chips,N==null?void 0:N.vusdtBalance,w]),L=c.useMemo(()=>$(T),[T]),Z=c.useMemo(()=>$(f),[f]),ee=f!==T,te=c.useMemo(()=>{const h=BigInt((d==null?void 0:d.reserveRng)??0),Y=BigInt((d==null?void 0:d.reserveVusdt)??0);return h>0n&&Y>0n},[d==null?void 0:d.reserveRng,d==null?void 0:d.reserveVusdt]),R=c.useMemo(()=>{const h=Z;if(h===null)return{invalid:!0,exceedsBalance:!1,out:0n,fee:0n,burned:0n,minOut:0n};const Y=h>M,K=w==="BUY_RNG",{out:ne,fee:ae,burned:ie}=Ye(d,h,K),oe=Ke(ne,k);return{invalid:!1,exceedsBalance:Y,out:ne,fee:ae,burned:ie,minOut:oe}},[d,M,Z,k,w]),z=c.useMemo(()=>N?L===null?"Enter a whole number amount":L<=0n?"Enter an amount":L>M?`Not enough ${B}`:te?ee?"Updating quote…":R.out<=0n?"Quote unavailable":null:"AMM not initialized yet":"Register to trade",[L,M,B,ee,N,te,R.out]),F=!i&&z===null,re=h=>{const Y=Math.max(0,Math.min(100,Math.floor(h))),K=M*BigInt(Y)/100n;a(K.toString())};return e.jsxs("section",{className:"border border-gray-800 rounded p-4 bg-gray-900/30 lg:col-span-2",children:[e.jsx("div",{className:"text-xs text-gray-400 tracking-widest mb-3",children:"AMM (RNG/vUSDT)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"border border-gray-800 rounded p-3 bg-black/30",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"RESERVE RNG"}),e.jsx("div",{className:"text-white mt-1",children:(d==null?void 0:d.reserveRng)??0})]}),e.jsxs("div",{className:"border border-gray-800 rounded p-3 bg-black/30",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"RESERVE vUSDT"}),e.jsx("div",{className:"text-white mt-1",children:(d==null?void 0:d.reserveVusdt)??0})]}),e.jsxs("div",{className:"border border-gray-800 rounded p-3 bg-black/30",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"PRICE"}),e.jsx("div",{className:"text-white mt-1",children:S.price===null?"—":S.price.toFixed(6)}),e.jsx("div",{className:"text-[10px] text-gray-600",children:"vUSDT per RNG"})]}),e.jsxs("div",{className:"border border-gray-800 rounded p-3 bg-black/30",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"TVL"}),e.jsx("div",{className:"text-white mt-1",children:S.tvlVusdt.toString()}),e.jsx("div",{className:"text-[10px] text-gray-600",children:"~vUSDT"})]})]}),e.jsxs("div",{className:"mt-4 border-t border-gray-800 pt-4 space-y-3",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"SWAP"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{className:"bg-gray-950 border border-gray-800 rounded px-2 py-1 text-xs",value:w,onChange:h=>C(h.target.value),children:[e.jsx("option",{value:"BUY_RNG",children:"Buy RNG (vUSDT → RNG)"}),e.jsx("option",{value:"SELL_RNG",children:"Sell RNG (RNG → vUSDT)"})]}),e.jsx("button",{type:"button",className:"h-11 px-3 rounded border border-gray-800 text-gray-300 text-[10px] tracking-widest uppercase hover:border-gray-600 hover:text-white",onClick:()=>C(w==="BUY_RNG"?"SELL_RNG":"BUY_RNG"),title:"Flip direction",children:"Flip"}),e.jsxs("select",{className:"bg-gray-950 border border-gray-800 rounded px-2 py-1 text-xs",value:k,onChange:h=>_(parseInt(h.target.value)),children:[e.jsx("option",{value:50,children:"0.50% slippage"}),e.jsx("option",{value:100,children:"1.00% slippage"}),e.jsx("option",{value:200,children:"2.00% slippage"}),e.jsx("option",{value:500,children:"5.00% slippage"})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 text-[10px] text-gray-600 tracking-widest uppercase",children:[e.jsxs("span",{children:["Amount In (",B,")"]}),e.jsxs("span",{children:["Balance ",e.jsx("span",{className:"text-white",children:M.toString()})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"flex-1 min-w-[180px] h-11 bg-gray-950 border border-gray-800 rounded px-2 text-xs",value:T,onChange:h=>a(h.target.value),placeholder:`Amount in ${B}`,inputMode:"numeric",pattern:"[0-9]*"}),e.jsx("button",{type:"button",className:"h-11 px-3 rounded border border-gray-800 text-gray-300 text-[10px] tracking-widest uppercase hover:border-gray-600 hover:text-white",onClick:()=>a(M.toString()),disabled:M<=0n,title:"Max",children:"Max"}),[25,50,75,100].map(h=>e.jsxs("button",{type:"button",className:"h-11 px-3 rounded border border-gray-800 text-gray-300 text-[10px] tracking-widest uppercase hover:border-gray-600 hover:text-white",onClick:()=>re(h),disabled:M<=0n,title:`${h}%`,children:[h,"%"]},h)),e.jsx("button",{className:["h-11 px-3 rounded border text-[10px] tracking-widest uppercase",F?"border-terminal-accent text-terminal-accent hover:bg-terminal-accent/10":"border-gray-800 text-gray-600 cursor-not-allowed"].join(" "),onClick:()=>F?E(!0):null,disabled:!F,children:"Swap"})]}),z?e.jsx("div",{className:"text-[10px] text-terminal-accent",children:z}):e.jsxs("div",{className:"text-[10px] text-gray-500 leading-relaxed",children:["Est. out: ",e.jsx("span",{className:"text-white",children:R.out.toString()})," · Min out:"," ",e.jsx("span",{className:"text-white",children:R.minOut.toString()}),R.burned>0n?` · Burn: ${R.burned.toString()}`:"",R.fee>0n?` · Fee: ${R.fee.toString()}`:""]})]}),e.jsx($e,{open:G,title:"Confirm Swap",confirmText:"Confirm Swap",loading:i,onClose:()=>i?null:E(!1),onConfirm:async()=>{if(!F||L===null||L<=0n)return;const h=w==="BUY_RNG";O(!0);try{await u({amountIn:L,minOut:R.minOut,isBuyingRng:h}),E(!1)}finally{O(!1)}},children:e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest uppercase",children:"Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-[11px]",children:[e.jsx("div",{className:"text-gray-500",children:"You pay"}),e.jsxs("div",{className:"text-white text-right",children:[L===null?"—":L.toString()," ",B]}),e.jsx("div",{className:"text-gray-500",children:"Est. receive"}),e.jsxs("div",{className:"text-white text-right",children:[R.out.toString()," ",w==="BUY_RNG"?"RNG":"vUSDT"]}),e.jsx("div",{className:"text-gray-500",children:"Min receive"}),e.jsxs("div",{className:"text-white text-right",children:[R.minOut.toString()," ",w==="BUY_RNG"?"RNG":"vUSDT"]}),e.jsx("div",{className:"text-gray-500",children:"Price tolerance"}),e.jsxs("div",{className:"text-white text-right",children:[(k/100).toFixed(2),"%"]}),R.burned>0n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-gray-500",children:"Burn"}),e.jsxs("div",{className:"text-white text-right",children:[R.burned.toString()," RNG"]})]}):null,R.fee>0n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-gray-500",children:"Fee"}),e.jsxs("div",{className:"text-white text-right",children:[R.fee.toString()," ",B]})]}):null]}),e.jsx("div",{className:"text-[10px] text-gray-600 leading-relaxed",children:"You may be prompted by your passkey to confirm this transaction."})]})})]})},We=c.lazy(()=>Ne(()=>import("./BorrowPanel-DMKTyuTk.js"),__vite__mapDeps([0,1,2])).then(d=>({default:d.BorrowPanel}))),Xe=c.lazy(()=>Ne(()=>import("./LiquidityPanel-BKeBNJhV.js"),__vite__mapDeps([3,1,2,4,5])).then(d=>({default:d.LiquidityPanel})));function tt(){var he,be,ve,pe;const d=Ve().pathname,S=d.startsWith("/borrow")?"borrow":d.startsWith("/liquidity")?"liquidity":"swap",N=S==="swap"?"Swap":S==="borrow"?"Borrow":"Liquidity",[w,k]=c.useState(null),[T,C]=c.useState(null),_=Oe("economy",12),a=Fe(),u=c.useRef(null),[G,E]=c.useState(!1),[i,O]=c.useState(null),[f,se]=c.useState(null),[B,M]=c.useState(null),[L,Z]=c.useState(null),[ee,te]=c.useState(null),[R,z]=c.useState("Trader"),[F,re]=c.useState("0"),[h,Y]=c.useState("0"),[K,ne]=c.useState("0"),[ae,ie]=c.useState("BUY_RNG"),[oe,we]=c.useState("0"),[de,je]=c.useState(100),[ue,Se]=c.useState("0"),[xe,ke]=c.useState("0"),[ge,Re]=c.useState("0"),m=(n,t="info")=>{Ae("economy",n,t)},V=(n,t,r)=>{var l;Pe({surface:"economy",kind:n,message:t,pubkeyHex:(l=a.keypair)==null?void 0:l.publicKeyHex,nonce:typeof(r==null?void 0:r.nonce)=="number"?r.nonce:void 0,txHash:r==null?void 0:r.txHash,txDigest:r==null?void 0:r.txDigest})},Be=c.useMemo(()=>{switch(a.status){case"connected":return"Connected";case"connecting":return"Connecting…";case"vault_locked":case"missing_identity":return a.statusDetail??"Not ready";case"error":return a.statusDetail??a.error??"Failed to connect";default:return"Connecting…"}},[a.error,a.status,a.statusDetail]),I=()=>{const n=a.client;return n!=null&&n.nonceManager?n:(a.status==="vault_locked"?m("Vault locked — unlock to continue"):m("Client not ready"),null)},ce=({isActive:n})=>["flex-1 sm:flex-none inline-flex items-center justify-center h-11 px-3 rounded border text-[10px] tracking-widest uppercase transition-colors",n?"border-terminal-green text-terminal-green bg-terminal-green/10":"border-gray-800 text-gray-400 hover:border-gray-600 hover:text-white"].join(" ");c.useEffect(()=>{a.status==="connected"?m("Connected"):a.status==="vault_locked"?m("Vault locked — unlock to continue","error"):a.status==="missing_identity"?m("Missing VITE_IDENTITY (see website/README.md).","error"):a.status==="error"&&m(a.error??"Failed to connect","error")},[a.error,a.status]),c.useEffect(()=>{if(a.status!=="connected"||!a.keypair)return;const n=a.keypair.publicKeyHex,t=n.toLowerCase(),r=a.onEvent("CasinoError",s=>{var g,o;if(((o=(g=s==null?void 0:s.player)==null?void 0:g.toLowerCase)==null?void 0:o.call(g))!==t)return;const x=(s==null?void 0:s.message)??"Unknown error";Ue({surface:"economy",finalMessage:x,pubkeyHex:n,error:x}),H("error",x),j("economy.error",{message:x})}),l=a.onEvent("CasinoPlayerRegistered",s=>{var o,b,y;if(((b=(o=s==null?void 0:s.player)==null?void 0:o.toLowerCase)==null?void 0:b.call(o))!==t)return;const x=(s==null?void 0:s.name)??"—",g=`Registered: ${x}`;U({surface:"economy",kind:"register",finalMessage:g,pubkeyHex:n}),H("success",g),(y=u.current)==null||y.call(u),j("economy.register.confirmed",{name:x})}),v=a.onEvent("CasinoDeposited",s=>{var b,y,ye;if(((y=(b=s==null?void 0:s.player)==null?void 0:b.toLowerCase)==null?void 0:y.call(b))!==t)return;const x=(s==null?void 0:s.amount)??0,g=(s==null?void 0:s.new_chips)??(s==null?void 0:s.newChips)??(s==null?void 0:s.new_chips)??0,o=`Deposit confirmed: +${x} (chips=${g})`;U({surface:"economy",kind:"deposit",finalMessage:o,pubkeyHex:n}),H("success",o),(ye=u.current)==null||ye.call(u),j("economy.deposit.confirmed",{amount:x,newChips:g})}),p=a.onEvent("VaultCreated",s=>{var x,g,o;((g=(x=s==null?void 0:s.player)==null?void 0:x.toLowerCase)==null?void 0:g.call(x))===t&&(U({surface:"economy",kind:"create_vault",finalMessage:"Vault created",pubkeyHex:n}),H("success","Vault created"),(o=u.current)==null||o.call(u),j("economy.vault.created"))}),D=a.onEvent("CollateralDeposited",s=>{var o,b,y;if(((b=(o=s==null?void 0:s.player)==null?void 0:o.toLowerCase)==null?void 0:b.call(o))!==t)return;const x=(s==null?void 0:s.amount)??0,g=`Collateral deposited: ${x}`;U({surface:"economy",kind:"deposit_collateral",finalMessage:g,pubkeyHex:n}),H("success",g),(y=u.current)==null||y.call(u),j("economy.vault.collateral_deposited",{amount:x})}),P=a.onEvent("VusdtBorrowed",s=>{var o,b,y;if(((b=(o=s==null?void 0:s.player)==null?void 0:o.toLowerCase)==null?void 0:b.call(o))!==t)return;const x=(s==null?void 0:s.amount)??0,g=`Borrowed vUSDT: ${x}`;U({surface:"economy",kind:"borrow",finalMessage:g,pubkeyHex:n}),H("success",g),(y=u.current)==null||y.call(u),j("economy.vault.borrowed",{amount:x})}),W=a.onEvent("VusdtRepaid",s=>{var o,b,y;if(((b=(o=s==null?void 0:s.player)==null?void 0:o.toLowerCase)==null?void 0:b.call(o))!==t)return;const x=(s==null?void 0:s.amount)??0,g=`Repaid vUSDT: ${x}`;U({surface:"economy",kind:"repay",finalMessage:g,pubkeyHex:n}),H("success",g),(y=u.current)==null||y.call(u),j("economy.vault.repaid",{amount:x})}),X=a.onEvent("AmmSwapped",s=>{var o,b,y;if(((b=(o=s==null?void 0:s.player)==null?void 0:o.toLowerCase)==null?void 0:b.call(o))!==t)return;const x=(s==null?void 0:s.amountOut)??(s==null?void 0:s.amount_out)??0,g=`Swap executed: out=${x}`;U({surface:"economy",kind:"swap",finalMessage:g,pubkeyHex:n}),H("success",g),(y=u.current)==null||y.call(u),j("economy.swap.confirmed",{amountOut:x})}),Q=a.onEvent("LiquidityAdded",s=>{var o,b,y;if(((b=(o=s==null?void 0:s.player)==null?void 0:o.toLowerCase)==null?void 0:b.call(o))!==t)return;const x=(s==null?void 0:s.sharesMinted)??(s==null?void 0:s.shares_minted)??0,g=`Liquidity added: shares=${x}`;U({surface:"economy",kind:"add_liquidity",finalMessage:g,pubkeyHex:n}),H("success",g),(y=u.current)==null||y.call(u),j("economy.liquidity.added",{sharesMinted:x})}),J=a.onEvent("LiquidityRemoved",s=>{var o,b,y;if(((b=(o=s==null?void 0:s.player)==null?void 0:o.toLowerCase)==null?void 0:b.call(o))!==t)return;const x=(s==null?void 0:s.sharesBurned)??(s==null?void 0:s.shares_burned)??0,g=`Liquidity removed: shares=${x}`;U({surface:"economy",kind:"remove_liquidity",finalMessage:g,pubkeyHex:n}),H("success",g),(y=u.current)==null||y.call(u),j("economy.liquidity.removed",{sharesBurned:x})});return()=>{try{r==null||r(),l==null||l(),v==null||v(),p==null||p(),D==null||D(),P==null||P(),W==null||W(),X==null||X(),Q==null||Q(),J==null||J()}catch{}}},[(he=a.keypair)==null?void 0:he.publicKeyHex,a.onEvent,a.status]),c.useEffect(()=>{var D;const n=a.client,t=(D=a.keypair)==null?void 0:D.publicKey;if(!n||!t)return;let r=!1,l=!1;const v=async()=>{if(!(r||l)&&!(typeof document<"u"&&document.visibilityState==="hidden")){l=!0;try{const[P,W,X,Q,J]=await Promise.all([n.getCasinoPlayer(t),n.getVault(t),n.getAmmPool(),n.getLpBalance(t),n.getHouse()]);O(P),E(!!P),se(W),M(X),Z(Q),te(J)}catch{}finally{l=!1}}};v(),u.current=()=>{v()};const p=setInterval(v,3e3);return()=>{r=!0,u.current=null,clearInterval(p)}},[a.client,(be=a.keypair)==null?void 0:be.publicKeyHex]);const A=c.useMemo(()=>{const n=BigInt((B==null?void 0:B.reserveRng)??0),t=BigInt((B==null?void 0:B.reserveVusdt)??0),r=n>0n?Number(t)/Number(n):null,l=t*2n;return{reserveRng:n,reserveVusdt:t,price:r,tvlVusdt:l}},[B]),me=c.useMemo(()=>{const n=BigInt((f==null?void 0:f.collateralRng)??0),t=BigInt((f==null?void 0:f.debtVusdt)??0),r=A.reserveRng>0n?A.reserveVusdt:1n,l=A.reserveRng>0n?A.reserveRng:1n,v=l>0n?n*r/l:0n,p=v>0n?Number(t*10000n/v):0,D=v/2n,P=D>t?D-t:0n;return{ltvBps:p,availableDebt:P}},[A.reserveRng,A.reserveVusdt,f]),q=async()=>{const n=I();if(!n||G)return;const t=R.trim()||`Trader_${Date.now().toString(36)}`,r=await n.nonceManager.submitCasinoRegister(t);r!=null&&r.txHash&&(k(r.txHash),C(r.txDigest??null)),j("economy.register.submitted",{name:t}),V("register",`Submitted register (${t})`,r)},Ce=async()=>{const n=I();if(!n)return;await q();const t=await n.nonceManager.submitCasinoDeposit(1e3);t!=null&&t.txHash&&(k(t.txHash),C(t.txDigest??null)),j("economy.faucet.submitted",{amount:1e3}),V("deposit","Submitted faucet claim (1000 RNG)",t)},Le=async()=>{const n=I();if(!n)return;await q();const t=await n.nonceManager.submitCreateVault();t!=null&&t.txHash&&(k(t.txHash),C(t.txDigest??null)),j("economy.vault.create.submitted"),V("create_vault","Submitted create vault",t)},Te=async()=>{const n=I();if(!n)return;if(await q(),!f){m("Create a vault first");return}if(!i){m("Register to continue");return}const t=$(F);if(t===null||t<=0n){m("Collateral amount must be greater than zero");return}const r=BigInt((i==null?void 0:i.chips)??0);if(t>r){m("Not enough RNG");return}const l=await n.nonceManager.submitDepositCollateral(t.toString());l!=null&&l.txHash&&(k(l.txHash),C(l.txDigest??null)),j("economy.vault.deposit_collateral.submitted",{amount:t.toString()}),V("deposit_collateral",`Submitted deposit collateral (${t})`,l)},_e=async()=>{const n=I();if(!n)return;if(await q(),!f){m("Create a vault first");return}const t=$(h);if(t===null||t<=0n){m("Borrow amount must be greater than zero");return}if(BigInt((f==null?void 0:f.collateralRng)??0)<=0n){m("Deposit collateral first");return}if(t>me.availableDebt){m("Borrow exceeds available");return}const r=await n.nonceManager.submitBorrowUsdt(t.toString());r!=null&&r.txHash&&(k(r.txHash),C(r.txDigest??null)),j("economy.vault.borrow.submitted",{amount:t.toString()}),V("borrow",`Submitted borrow (${t} vUSDT)`,r)},Me=async()=>{const n=I();if(!n)return;if(await q(),!f){m("Create a vault first");return}if(!i){m("Register to continue");return}const t=$(K);if(t===null||t<=0n){m("Repay amount must be greater than zero");return}const r=BigInt((i==null?void 0:i.vusdtBalance)??0);if(t>r){m("Not enough vUSDT");return}const l=BigInt((f==null?void 0:f.debtVusdt)??0);if(t>l){m("Repay exceeds debt");return}const v=await n.nonceManager.submitRepayUsdt(t.toString());v!=null&&v.txHash&&(k(v.txHash),C(v.txDigest??null)),j("economy.vault.repay.submitted",{amount:t.toString()}),V("repay",`Submitted repay (${t} vUSDT)`,v)},De=async({amountIn:n,minOut:t,isBuyingRng:r})=>{const l=I();if(!l)return;if(await q(),!i){m("Register to trade");return}if(typeof n!="bigint"||n<=0n){m("Invalid swap amount");return}const v=BigInt(r?(i==null?void 0:i.vusdtBalance)??0:(i==null?void 0:i.chips)??0);if(n>v){m(r?"Not enough vUSDT":"Not enough RNG");return}const p=await l.nonceManager.submitSwap(n.toString(),t.toString(),r);p!=null&&p.txHash&&(k(p.txHash),C(p.txDigest??null)),j("economy.swap.submitted",{amountIn:n.toString(),minOut:t.toString(),direction:r?"BUY_RNG":"SELL_RNG",slippageBps:de}),V("swap",`Submitted swap in=${n} minOut=${t}`,p)},Ee=async()=>{const n=I();if(!n)return;if(await q(),!i){m("Register to continue");return}const t=$(ue),r=$(xe);if(t===null||r===null||t<=0n||r<=0n){m("Liquidity amounts must be greater than zero");return}const l=BigInt((i==null?void 0:i.chips)??0),v=BigInt((i==null?void 0:i.vusdtBalance)??0);if(t>l){m("Not enough RNG");return}if(r>v){m("Not enough vUSDT");return}const p=await n.nonceManager.submitAddLiquidity(t.toString(),r.toString());p!=null&&p.txHash&&(k(p.txHash),C(p.txDigest??null)),j("economy.liquidity.add.submitted",{rng:t.toString(),vusdt:r.toString()}),V("add_liquidity",`Submitted add liquidity (RNG=${t}, vUSDT=${r})`,p)},He=async()=>{const n=I();if(!n)return;await q();const t=$(ge);if(t===null||t<=0n){m("Share amount must be greater than zero");return}const r=BigInt((L==null?void 0:L.balance)??0);if(t>r){m("Not enough LP shares");return}const l=await n.nonceManager.submitRemoveLiquidity(t.toString());l!=null&&l.txHash&&(k(l.txHash),C(l.txDigest??null)),j("economy.liquidity.remove.submitted",{shares:t.toString()}),V("remove_liquidity",`Submitted remove liquidity (shares=${t})`,l)};return e.jsxs("div",{className:"min-h-screen bg-terminal-black text-white font-mono",children:[e.jsx(Ge,{title:`Economy — ${N}`,status:Be,leading:e.jsx(qe,{}),right:e.jsxs(e.Fragment,{children:[e.jsx(Ie,{rng:i==null?void 0:i.chips,vusdt:i==null?void 0:i.vusdtBalance,pubkeyHex:(ve=a.keypair)==null?void 0:ve.publicKeyHex}),w?T?e.jsxs(fe,{to:`/explorer/tx/${T}`,className:"text-[10px] text-terminal-green tracking-widest hover:underline",title:T,children:["LAST TX: ",w]}):e.jsxs("div",{className:"text-[10px] text-gray-500 tracking-widest",children:["LAST TX: ",w]}):null]})}),e.jsx("div",{className:"px-4 py-3 border-b border-gray-800 bg-terminal-black/90 backdrop-blur",children:e.jsxs("nav",{className:"flex items-center gap-2",children:[e.jsx(le,{to:"/swap",end:!0,className:ce,children:"Swap"}),e.jsx(le,{to:"/borrow",className:ce,children:"Borrow"}),e.jsx(le,{to:"/liquidity",className:ce,children:"Liquidity"})]})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("section",{className:"border border-gray-800 rounded p-4 bg-gray-900/30 lg:col-span-1",children:[e.jsx("div",{className:"text-xs text-gray-400 tracking-widest mb-3",children:"WALLET"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:["Registered: ",e.jsx("span",{className:G?"text-terminal-green":"text-terminal-accent",children:G?"YES":"NO"})]}),e.jsxs("div",{children:["RNG: ",e.jsx("span",{className:"text-white",children:(i==null?void 0:i.chips)??0})]}),e.jsxs("div",{children:["vUSDT: ",e.jsx("span",{className:"text-white",children:(i==null?void 0:i.vusdtBalance)??0})]}),e.jsxs("div",{className:"text-[10px] text-gray-600 break-all",children:["PK: ",((pe=a.keypair)==null?void 0:pe.publicKeyHex)??"—"]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"flex-1 bg-gray-950 border border-gray-800 rounded px-2 py-1 text-xs",value:R,onChange:n=>z(n.target.value),placeholder:"Name"}),e.jsx("button",{className:"text-xs px-3 py-1 rounded border border-terminal-green text-terminal-green hover:bg-terminal-green/10",onClick:q,children:"Register"})]}),e.jsx("button",{className:"w-full text-xs px-3 py-2 rounded border border-terminal-green bg-terminal-green/10 text-terminal-green hover:bg-terminal-green/20",onClick:Ce,children:"Daily Faucet (1000 RNG)"})]})]}),S==="swap"?e.jsx(ze,{amm:B,ammDerived:A,player:i,swapDirection:ae,slippageBps:de,swapAmountIn:oe,setSwapDirection:ie,setSlippageBps:je,setSwapAmountIn:we,onSubmitSwap:De}):null,S==="liquidity"?e.jsx(c.Suspense,{fallback:e.jsxs("section",{className:"border border-gray-800 rounded p-4 bg-gray-900/30 lg:col-span-2",children:[e.jsx("div",{className:"text-xs text-gray-400 tracking-widest mb-3",children:"AMM (RNG/vUSDT)"}),e.jsx("div",{className:"text-[11px] text-gray-600",children:"Loading…"})]}),children:e.jsx(Xe,{amm:B,ammDerived:A,lpBalance:L,addLiqRng:ue,addLiqVusdt:xe,removeLiqShares:ge,setAddLiqRng:Se,setAddLiqVusdt:ke,setRemoveLiqShares:Re,onAddLiquidity:Ee,onRemoveLiquidity:He})}):null,S==="borrow"?e.jsx(c.Suspense,{fallback:e.jsxs("section",{className:"border border-gray-800 rounded p-4 bg-gray-900/30 lg:col-span-2",children:[e.jsx("div",{className:"text-xs text-gray-400 tracking-widest mb-3",children:"VAULT (CDP)"}),e.jsx("div",{className:"text-[11px] text-gray-600",children:"Loading…"})]}),children:e.jsx(We,{vault:f,vaultDerived:me,house:ee,collateralAmount:F,borrowAmount:h,repayAmount:K,setCollateralAmount:re,setBorrowAmount:Y,setRepayAmount:ne,onCreateVault:Le,onDepositCollateral:Te,onBorrowVusdt:_e,onRepayVusdt:Me})}):null]}),e.jsxs("section",{className:"mt-4 border border-gray-800 rounded p-4 bg-gray-900/30",children:[e.jsx("div",{className:"text-xs text-gray-400 tracking-widest mb-3",children:"ACTIVITY"}),e.jsxs("div",{className:"space-y-1 text-[11px] text-gray-300",children:[_.length===0?e.jsx("div",{className:"text-gray-600",children:"No activity yet."}):null,_.map(n=>{const t=n.type==="tx",r=t?n.finalMessage??n.message:n.message,l=new Date(t?n.updatedTs:n.ts).toLocaleTimeString(),v=t?n.status==="submitted"?"PENDING":n.status==="confirmed"?"OK":"FAIL":n.level==="error"?"ERROR":n.level==="success"?"OK":"INFO",p=t?n.status==="confirmed"?"text-terminal-green":n.status==="failed"?"text-terminal-accent":"text-gray-500":n.level==="error"?"text-terminal-accent":n.level==="success"?"text-terminal-green":"text-gray-500",D=t&&n.txDigest?e.jsx(fe,{to:`/explorer/tx/${n.txDigest}`,className:"truncate hover:underline",title:n.txDigest,children:r}):e.jsx("div",{className:"truncate",children:r});return e.jsxs("div",{className:"flex items-center justify-between gap-3 border-b border-gray-900 py-1",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:`text-[10px] tracking-widest ${p}`,children:v}),e.jsx("div",{className:"min-w-0 flex-1",children:D})]}),e.jsx("div",{className:"text-[10px] text-gray-600",children:l})]},n.id)})]})]})]})]})}export{tt as default};
