import{a as d,j as e,P as be,c as he,C as ye}from"./index-B-AtvNOI.js";function f(v){const h=v.trim();if(!h)return 0n;try{const S=BigInt(h);return S<0n?null:S}catch{return null}}function Y(v,h,S){if(!v)return{out:0n,fee:0n,burned:0n};const m=BigInt(v.reserveRng??0),C=BigInt(v.reserveVusdt??0),A=BigInt(v.feeBasisPoints??0),g=BigInt(v.sellTaxBasisPoints??0);if(h<=0n||m<=0n||C<=0n)return{out:0n,fee:0n,burned:0n};let j=0n,R=h,k=C,B=m;S||(k=m,B=C,j=h*g/10000n,R=h-j);const y=R*A/10000n,E=R-y,u=k+E;return u<=0n?{out:0n,fee:y,burned:j}:{out:E*B/u,fee:y,burned:j}}function Ne(){const[v,h]=d.useState("Initializing…"),[S,m]=d.useState(null),[C,A]=d.useState([]),g=d.useRef(null),j=d.useRef(null),R=d.useRef(null),[k,B]=d.useState(!1),[y,E]=d.useState(null),[u,H]=d.useState(null),[x,_]=d.useState(null),[D,W]=d.useState(null),[N,z]=d.useState(null),[M,Q]=d.useState("Trader"),[q,X]=d.useState("0"),[G,J]=d.useState("0"),[$,Z]=d.useState("0"),[T,ee]=d.useState("BUY_RNG"),[V,te]=d.useState("0"),[U,re]=d.useState(100),[P,ae]=d.useState("0"),[O,se]=d.useState("0"),[K,ne]=d.useState("0"),l=t=>{A(r=>[{ts:Date.now(),message:t},...r].slice(0,12))};d.useEffect(()=>((async()=>{try{const r="92b050b6fbe80695b5d56835e978918e37c8707a7fad09a01ae782d4c3170c9baa4c2c196b36eac6b78ceb210b287aeb0727ef1c60e48042142f7bcc8b6382305cd50c5a4542c44ec72a4de6640c194f8ef36bea1dbed168ab6fd8681d910d55",a=new he(r);await a.init();const i=new ye("/api",a);await i.init();const o=i.getOrCreateKeypair();if(!o){h("Unlock passkey vault (see Vault tab)."),l("Vault locked — unlock to continue");return}j.current=o.publicKey,R.current=o.publicKeyHex,g.current=i,await i.connectUpdates(o.publicKey);const b=await i.getAccount(o.publicKey);await i.initNonceManager(o.publicKeyHex,o.publicKey,b);const p=o.publicKeyHex.toLowerCase();i.onEvent("CasinoError",s=>{var n,c;((c=(n=s==null?void 0:s.player)==null?void 0:n.toLowerCase)==null?void 0:c.call(n))===p&&l(`ERROR: ${s.message??"Unknown error"}`)}),i.onEvent("VaultCreated",s=>{var n,c;((c=(n=s==null?void 0:s.player)==null?void 0:n.toLowerCase)==null?void 0:c.call(n))===p&&l("Vault created")}),i.onEvent("CollateralDeposited",s=>{var n,c;((c=(n=s==null?void 0:s.player)==null?void 0:n.toLowerCase)==null?void 0:c.call(n))===p&&l(`Collateral deposited: ${s.amount}`)}),i.onEvent("VusdtBorrowed",s=>{var n,c;((c=(n=s==null?void 0:s.player)==null?void 0:n.toLowerCase)==null?void 0:c.call(n))===p&&l(`Borrowed vUSDT: ${s.amount}`)}),i.onEvent("VusdtRepaid",s=>{var n,c;((c=(n=s==null?void 0:s.player)==null?void 0:n.toLowerCase)==null?void 0:c.call(n))===p&&l(`Repaid vUSDT: ${s.amount}`)}),i.onEvent("AmmSwapped",s=>{var n,c;((c=(n=s==null?void 0:s.player)==null?void 0:n.toLowerCase)==null?void 0:c.call(n))===p&&l(`Swap executed: out=${s.amountOut}`)}),i.onEvent("LiquidityAdded",s=>{var n,c;((c=(n=s==null?void 0:s.player)==null?void 0:n.toLowerCase)==null?void 0:c.call(n))===p&&l(`Liquidity added: shares=${s.sharesMinted}`)}),i.onEvent("LiquidityRemoved",s=>{var n,c;((c=(n=s==null?void 0:s.player)==null?void 0:n.toLowerCase)==null?void 0:c.call(n))===p&&l(`Liquidity removed: shares=${s.sharesBurned}`)}),h("Connected"),l("Connected")}catch{h("Failed to connect. Check simulator + dev-executor.")}})(),()=>{var a;const r=g.current;try{(a=r==null?void 0:r.destroy)==null||a.call(r)}catch{}g.current=null,j.current=null,R.current=null}),[]),d.useEffect(()=>{const t=setInterval(async()=>{const r=g.current,a=j.current;if(!(!r||!a))try{const[i,o,b,p,s]=await Promise.all([r.getCasinoPlayer(a),r.getVault(a),r.getAmmPool(),r.getLpBalance(a),r.getHouse()]);E(i),B(!!i),H(o),_(b),W(p),z(s)}catch{}},1e3);return()=>clearInterval(t)},[]);const L=d.useMemo(()=>{const t=BigInt((x==null?void 0:x.reserveRng)??0),r=BigInt((x==null?void 0:x.reserveVusdt)??0),a=BigInt((x==null?void 0:x.totalShares)??0),i=t>0n?Number(r)/Number(t):null,o=r*2n,b=a>0n?Number(o)/Number(a):null,p=BigInt((u==null?void 0:u.collateralRng)??0),s=BigInt((u==null?void 0:u.debtVusdt)??0),n=t>0n?r:1n,c=t>0n?t:1n,I=c>0n?p*n/c:0n,me=I>0n?Number(s*10000n/I):0,F=I/2n,pe=F>s?F-s:0n;return{reserveRng:t,reserveVusdt:r,totalShares:a,price:i,tvlVusdt:o,lpPrice:b,collateral:p,debt:s,collateralValue:I,ltvBps:me,availableDebt:pe}},[x,u]),w=async()=>{const t=g.current;if(!(t!=null&&t.nonceManager))throw new Error("Client not ready");if(k)return;const r=M.trim()||`Trader_${Date.now().toString(36)}`,a=await t.nonceManager.submitCasinoRegister(r);a!=null&&a.txHash&&m(a.txHash),l(`Submitted register (${r})`)},ie=async()=>{const t=g.current;if(!(t!=null&&t.nonceManager))throw new Error("Client not ready");await w();const r=await t.nonceManager.submitCasinoDeposit(1e3);r!=null&&r.txHash&&m(r.txHash),l("Submitted faucet claim (1000 RNG)")},ce=async()=>{const t=g.current;if(!(t!=null&&t.nonceManager))throw new Error("Client not ready");await w();const r=await t.nonceManager.submitCreateVault();r!=null&&r.txHash&&m(r.txHash),l("Submitted create vault")},le=async()=>{const t=g.current;if(!(t!=null&&t.nonceManager))throw new Error("Client not ready");await w();const r=f(q);if(r===null){l("Invalid collateral amount");return}const a=await t.nonceManager.submitDepositCollateral(r.toString());a!=null&&a.txHash&&m(a.txHash),l(`Submitted deposit collateral (${r})`)},de=async()=>{const t=g.current;if(!(t!=null&&t.nonceManager))throw new Error("Client not ready");await w();const r=f(G);if(r===null){l("Invalid borrow amount");return}const a=await t.nonceManager.submitBorrowUsdt(r.toString());a!=null&&a.txHash&&m(a.txHash),l(`Submitted borrow (${r} vUSDT)`)},oe=async()=>{const t=g.current;if(!(t!=null&&t.nonceManager))throw new Error("Client not ready");await w();const r=f($);if(r===null){l("Invalid repay amount");return}const a=await t.nonceManager.submitRepayUsdt(r.toString());a!=null&&a.txHash&&m(a.txHash),l(`Submitted repay (${r} vUSDT)`)},xe=async()=>{const t=g.current;if(!(t!=null&&t.nonceManager))throw new Error("Client not ready");await w();const r=f(V);if(r===null){l("Invalid swap amount");return}const a=T==="BUY_RNG",{out:i}=Y(x,r,a),o=i*BigInt(1e4-U)/10000n,b=await t.nonceManager.submitSwap(r.toString(),o.toString(),a);b!=null&&b.txHash&&m(b.txHash),l(`Submitted swap in=${r} minOut=${o}`)},ue=async()=>{const t=g.current;if(!(t!=null&&t.nonceManager))throw new Error("Client not ready");await w();const r=f(P),a=f(O);if(r===null||a===null){l("Invalid add liquidity amounts");return}const i=await t.nonceManager.submitAddLiquidity(r.toString(),a.toString());i!=null&&i.txHash&&m(i.txHash),l(`Submitted add liquidity (RNG=${r}, vUSDT=${a})`)},ge=async()=>{const t=g.current;if(!(t!=null&&t.nonceManager))throw new Error("Client not ready");await w();const r=f(K);if(r===null){l("Invalid share amount");return}const a=await t.nonceManager.submitRemoveLiquidity(r.toString());a!=null&&a.txHash&&m(a.txHash),l(`Submitted remove liquidity (shares=${r})`)};return e.jsxs("div",{className:"min-h-screen bg-terminal-black text-white font-mono p-4",children:[e.jsxs("header",{className:"flex flex-wrap items-center justify-between gap-3 border-b border-gray-800 pb-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(be,{}),e.jsx("div",{className:"text-lg font-bold tracking-widest",children:"Liquidity / AMM"}),e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:v})]}),e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:S?`LAST TX: ${S}`:null})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("section",{className:"border border-gray-800 rounded p-4 bg-gray-900/30",children:[e.jsx("div",{className:"text-xs text-gray-400 tracking-widest mb-3",children:"WALLET"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:["Registered: ",e.jsx("span",{className:k?"text-terminal-green":"text-terminal-accent",children:k?"YES":"NO"})]}),e.jsxs("div",{children:["RNG: ",e.jsx("span",{className:"text-white",children:(y==null?void 0:y.chips)??0})]}),e.jsxs("div",{children:["vUSDT: ",e.jsx("span",{className:"text-white",children:(y==null?void 0:y.vusdtBalance)??0})]}),e.jsxs("div",{className:"text-[10px] text-gray-600 break-all",children:["PK: ",R.current??"—"]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"flex-1 bg-gray-950 border border-gray-800 rounded px-2 py-1 text-xs",value:M,onChange:t=>Q(t.target.value),placeholder:"Name"}),e.jsx("button",{className:"text-xs px-3 py-1 rounded border border-terminal-green text-terminal-green hover:bg-terminal-green/10",onClick:w,children:"Register"})]}),e.jsx("button",{className:"w-full text-xs px-3 py-2 rounded border border-terminal-green bg-terminal-green/10 text-terminal-green hover:bg-terminal-green/20",onClick:ie,children:"Daily Faucet (1000 RNG)"})]})]}),e.jsxs("section",{className:"border border-gray-800 rounded p-4 bg-gray-900/30",children:[e.jsx("div",{className:"text-xs text-gray-400 tracking-widest mb-3",children:"AMM (RNG/vUSDT)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"border border-gray-800 rounded p-3 bg-black/30",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"RESERVE RNG"}),e.jsx("div",{className:"text-white mt-1",children:(x==null?void 0:x.reserveRng)??0})]}),e.jsxs("div",{className:"border border-gray-800 rounded p-3 bg-black/30",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"RESERVE vUSDT"}),e.jsx("div",{className:"text-white mt-1",children:(x==null?void 0:x.reserveVusdt)??0})]}),e.jsxs("div",{className:"border border-gray-800 rounded p-3 bg-black/30",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"PRICE"}),e.jsx("div",{className:"text-white mt-1",children:L.price===null?"—":L.price.toFixed(6)}),e.jsx("div",{className:"text-[10px] text-gray-600",children:"vUSDT per RNG"})]}),e.jsxs("div",{className:"border border-gray-800 rounded p-3 bg-black/30",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"TVL"}),e.jsx("div",{className:"text-white mt-1",children:L.tvlVusdt.toString()}),e.jsx("div",{className:"text-[10px] text-gray-600",children:"~vUSDT"})]})]}),e.jsxs("div",{className:"mt-4 border-t border-gray-800 pt-4 space-y-3",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"SWAP"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{className:"bg-gray-950 border border-gray-800 rounded px-2 py-1 text-xs",value:T,onChange:t=>ee(t.target.value),children:[e.jsx("option",{value:"BUY_RNG",children:"Buy RNG (vUSDT → RNG)"}),e.jsx("option",{value:"SELL_RNG",children:"Sell RNG (RNG → vUSDT)"})]}),e.jsxs("select",{className:"bg-gray-950 border border-gray-800 rounded px-2 py-1 text-xs",value:U,onChange:t=>re(parseInt(t.target.value)),children:[e.jsx("option",{value:50,children:"0.50% slippage"}),e.jsx("option",{value:100,children:"1.00% slippage"}),e.jsx("option",{value:200,children:"2.00% slippage"}),e.jsx("option",{value:500,children:"5.00% slippage"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"flex-1 bg-gray-950 border border-gray-800 rounded px-2 py-1 text-xs",value:V,onChange:t=>te(t.target.value),placeholder:"Amount in"}),e.jsx("button",{className:"text-xs px-3 py-1 rounded border border-terminal-accent text-terminal-accent hover:bg-terminal-accent/10",onClick:xe,children:"Swap"})]}),(()=>{const t=f(V);if(t===null)return e.jsx("div",{className:"text-[10px] text-terminal-accent",children:"Invalid amount"});const r=T==="BUY_RNG",{out:a,fee:i,burned:o}=Y(x,t,r),b=a*BigInt(1e4-U)/10000n;return e.jsxs("div",{className:"text-[10px] text-gray-500 leading-relaxed",children:["Est. out: ",e.jsx("span",{className:"text-white",children:a.toString()})," · Min out: ",e.jsx("span",{className:"text-white",children:b.toString()}),o>0n?` · Burn: ${o.toString()}`:"",i>0n?` · Fee: ${i.toString()}`:""]})})()]}),e.jsxs("div",{className:"mt-4 border-t border-gray-800 pt-4 space-y-3",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"LIQUIDITY"}),e.jsxs("div",{className:"text-[10px] text-gray-600",children:["LP shares: ",e.jsx("span",{className:"text-white",children:(D==null?void 0:D.balance)??0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{className:"bg-gray-950 border border-gray-800 rounded px-2 py-1 text-xs",value:P,onChange:t=>ae(t.target.value),placeholder:"RNG"}),e.jsx("input",{className:"bg-gray-950 border border-gray-800 rounded px-2 py-1 text-xs",value:O,onChange:t=>se(t.target.value),placeholder:"vUSDT"})]}),e.jsx("button",{className:"w-full text-xs px-3 py-2 rounded border border-terminal-green text-terminal-green hover:bg-terminal-green/10",onClick:ue,children:"Add Liquidity"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"flex-1 bg-gray-950 border border-gray-800 rounded px-2 py-1 text-xs",value:K,onChange:t=>ne(t.target.value),placeholder:"Shares"}),e.jsx("button",{className:"text-xs px-3 py-1 rounded border border-gray-700 text-gray-300 hover:border-gray-500",onClick:ge,children:"Remove"})]})]})]}),e.jsxs("section",{className:"border border-gray-800 rounded p-4 bg-gray-900/30",children:[e.jsx("div",{className:"text-xs text-gray-400 tracking-widest mb-3",children:"VAULT (CDP)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"border border-gray-800 rounded p-3 bg-black/30",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"COLLATERAL RNG"}),e.jsx("div",{className:"text-white mt-1",children:(u==null?void 0:u.collateralRng)??0})]}),e.jsxs("div",{className:"border border-gray-800 rounded p-3 bg-black/30",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"DEBT vUSDT"}),e.jsx("div",{className:"text-white mt-1",children:(u==null?void 0:u.debtVusdt)??0})]}),e.jsxs("div",{className:"border border-gray-800 rounded p-3 bg-black/30",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"LTV"}),e.jsxs("div",{className:"text-white mt-1",children:[(L.ltvBps/100).toFixed(2),"%"]}),e.jsx("div",{className:"text-[10px] text-gray-600",children:"max 50%"})]}),e.jsxs("div",{className:"border border-gray-800 rounded p-3 bg-black/30",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"AVAILABLE BORROW"}),e.jsx("div",{className:"text-white mt-1",children:L.availableDebt.toString()}),e.jsx("div",{className:"text-[10px] text-gray-600",children:"vUSDT"})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("button",{className:"w-full text-xs px-3 py-2 rounded border border-terminal-green text-terminal-green hover:bg-terminal-green/10",onClick:ce,children:"Create Vault"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"flex-1 bg-gray-950 border border-gray-800 rounded px-2 py-1 text-xs",value:q,onChange:t=>X(t.target.value),placeholder:"Deposit collateral (RNG)"}),e.jsx("button",{className:"text-xs px-3 py-1 rounded border border-terminal-green text-terminal-green hover:bg-terminal-green/10",onClick:le,children:"Deposit"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"flex-1 bg-gray-950 border border-gray-800 rounded px-2 py-1 text-xs",value:G,onChange:t=>J(t.target.value),placeholder:"Borrow (vUSDT)"}),e.jsx("button",{className:"text-xs px-3 py-1 rounded border border-terminal-accent text-terminal-accent hover:bg-terminal-accent/10",onClick:de,children:"Borrow"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"flex-1 bg-gray-950 border border-gray-800 rounded px-2 py-1 text-xs",value:$,onChange:t=>Z(t.target.value),placeholder:"Repay (vUSDT)"}),e.jsx("button",{className:"text-xs px-3 py-1 rounded border border-gray-700 text-gray-300 hover:border-gray-500",onClick:oe,children:"Repay"})]})]}),e.jsxs("div",{className:"mt-4 border-t border-gray-800 pt-4",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest mb-2",children:"HOUSE (DEBUG)"}),e.jsxs("div",{className:"text-[10px] text-gray-600 space-y-1",children:[e.jsxs("div",{children:["Burned: ",e.jsx("span",{className:"text-white",children:(N==null?void 0:N.totalBurned)??0})]}),e.jsxs("div",{children:["Issuance: ",e.jsx("span",{className:"text-white",children:(N==null?void 0:N.totalIssuance)??0})]}),e.jsxs("div",{children:["Fees: ",e.jsx("span",{className:"text-white",children:(N==null?void 0:N.accumulatedFees)??0})]})]})]})]})]}),e.jsxs("section",{className:"mt-4 border border-gray-800 rounded p-4 bg-gray-900/30",children:[e.jsx("div",{className:"text-xs text-gray-400 tracking-widest mb-3",children:"ACTIVITY"}),e.jsxs("div",{className:"space-y-1 text-[11px] text-gray-300",children:[C.length===0?e.jsx("div",{className:"text-gray-600",children:"No activity yet."}):null,C.map(t=>e.jsxs("div",{className:"flex items-center justify-between gap-3 border-b border-gray-900 py-1",children:[e.jsx("div",{className:"truncate",children:t.message}),e.jsx("div",{className:"text-[10px] text-gray-600",children:new Date(t.ts).toLocaleTimeString()})]},t.ts))]})]})]})}export{Ne as default};
