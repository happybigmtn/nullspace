import{c as ie,a as o,d as U,e as oe,i as ce,f as K,s as le,j as e,P as de,h as ue,k as ye,l as xe,m as me,n as he,o as F,q as ge,v as be,w as pe,x as we}from"./index-B-AtvNOI.js";import{s as fe,P as ve,g as je,e as ke,c as Ne}from"./txTracker-DL4lrIpi.js";const D={betIntervalMs:2500,randomizeInterval:!0,betAmount:10},i={Baccarat:0,Blackjack:1,CasinoWar:2,Craps:3,VideoPoker:4,HiLo:5,Roulette:6,SicBo:7,ThreeCard:8,UltimateHoldem:9},H=[i.Baccarat,i.Blackjack,i.CasinoWar,i.Craps,i.VideoPoker,i.HiLo,i.Roulette,i.SicBo,i.ThreeCard,i.UltimateHoldem];class Te{constructor(a){this.wasm=null,this.nonce=0,this.sessionCounter=Date.now(),this.isRunning=!1,this.timer=null,this.config=D,this.baseUrl=a.baseUrl,this.identityHex=a.identityHex,this.privateKeyBytes=a.privateKeyBytes,this.onLog=a.onLog,this.config={...D,...a.config??{}}}log(a){var n;try{(n=this.onLog)==null||n.call(this,a)}catch{}}async init(){if(this.wasm)return;const a=new ie(this.identityHex);await a.init(),a.createKeypair(this.privateKeyBytes),this.wasm=a,await this.resyncNonce(),await this.ensureRegistered(),this.log(`Vault bot ready (pubkey=${a.getPublicKeyHex().slice(0,8)}…) nonce=${this.nonce}`)}start(){this.isRunning||(this.isRunning=!0,this.loop())}stop(){this.isRunning=!1,this.timer!==null&&(clearTimeout(this.timer),this.timer=null)}setConfig(a){this.config={...this.config,...a}}getRunning(){return this.isRunning}scheduleNext(){if(!this.isRunning)return;const a=this.config.randomizeInterval?Math.floor(this.config.betIntervalMs*(.5+Math.random())):this.config.betIntervalMs;this.timer=window.setTimeout(()=>void this.loop(),a)}async loop(){if(this.isRunning)try{await this.init(),await this.playRandomGame()}catch(a){this.log(`Vault bot error: ${(a==null?void 0:a.message)??String(a)}`);try{await this.resyncNonce()}catch{}}finally{this.scheduleNext()}}async submitTransaction(a){if(!this.wasm)throw new Error("bot-not-initialized");const n=this.wasm.wrapTransactionSubmission(a),r=await fetch(`${this.baseUrl}/submit`,{method:"POST",headers:{"Content-Type":"application/octet-stream"},body:n});if(!r.ok)throw new Error(`submit-failed:${r.status}`)}async getAccountState(a){if(!this.wasm)throw new Error("bot-not-initialized");const n=this.wasm.encodeAccountKey(a),r=this.wasm.hashKey(n),c=this.wasm.bytesToHex(r),d=await fetch(`${this.baseUrl}/state/${c}`);if(d.status===404)return null;if(!d.ok)throw new Error(`state-query-failed:${d.status}`);const y=await d.arrayBuffer(),h=new Uint8Array(y);if(h.length===0)return null;const m=this.wasm.decodeLookup(h);return m&&m.type==="Account"?{nonce:m.nonce}:null}async resyncNonce(){if(!this.wasm)throw new Error("bot-not-initialized");const a=this.wasm.getPublicKeyBytes(),n=await this.getAccountState(a);this.nonce=(n==null?void 0:n.nonce)??0}async ensureRegistered(){if(!this.wasm)throw new Error("bot-not-initialized");if(this.nonce!==0)return;const a=`Vault_${Date.now().toString(36)}`,n=this.wasm.createCasinoRegisterTransaction(this.nonce,a);try{await this.submitTransaction(n),this.nonce+=1,this.log(`Registered as ${a}`)}catch{await this.resyncNonce()}}async playRandomGame(){if(!this.wasm)throw new Error("bot-not-initialized");const a=H[Math.floor(Math.random()*H.length)],n=BigInt(++this.sessionCounter),r=this.config.betAmount,c=this.nonce,d=this.wasm.createCasinoStartGameTransaction(c,a,r,n);try{await this.submitTransaction(d),this.nonce++}catch{await this.resyncNonce();return}await new Promise(y=>setTimeout(y,25));for(const y of this.getGameMoves(a)){const h=this.wasm.createCasinoGameMoveTransaction(this.nonce,n,y);try{await this.submitTransaction(h),this.nonce++,await new Promise(m=>setTimeout(m,10))}catch{await this.resyncNonce();break}}}getGameMoves(a){switch(a){case i.Baccarat:return[this.serializeBaccaratBet(Math.floor(Math.random()*3),this.config.betAmount),new Uint8Array([1])];case i.Blackjack:return[new Uint8Array([1])];case i.CasinoWar:return[];case i.Craps:return[this.serializeCrapsBet(0,0,this.config.betAmount),new Uint8Array([2])];case i.VideoPoker:return[new Uint8Array([31])];case i.HiLo:return[new Uint8Array([Math.floor(Math.random()*2)])];case i.Roulette:return[new Uint8Array([1,0])];case i.SicBo:return[new Uint8Array([0,0])];case i.ThreeCard:return[new Uint8Array([0])];case i.UltimateHoldem:return[new Uint8Array([0]),new Uint8Array([4])];default:return[]}}serializeBaccaratBet(a,n){const r=new Uint8Array(10);return r[0]=0,r[1]=a,new DataView(r.buffer).setBigUint64(2,BigInt(n),!1),r}serializeCrapsBet(a,n,r){const c=new Uint8Array(11);return c[0]=0,c[1]=a,c[2]=n,new DataView(c.buffer).setBigUint64(3,BigInt(r),!1),c}}function Ae(){const[R,a]=o.useState("Loading…"),[n,r]=o.useState(null),[c,d]=o.useState(!1),[y,h]=o.useState(!1),[m,B]=o.useState(!1),[g,k]=o.useState(!!F()),[L,N]=o.useState(U().nullspacePublicKeyHex),[$,T]=o.useState(!1),[V,M]=o.useState([]),b=o.useRef(null),E=(()=>{try{return!1}catch{return!1}})(),[C,I]=o.useState(()=>oe()),[p,z]=o.useState(()=>ce()),[G,P]=o.useState(()=>K().length),[O,x]=o.useState(null),w=()=>{try{const t=je(),s={total:t.length,economy:0,staking:0,casino:0,security:0,system:0};for(const u of t){const l=u==null?void 0:u.surface;l==="economy"?s.economy+=1:l==="staking"?s.staking+=1:l==="casino"?s.casino+=1:l==="security"?s.security+=1:s.system+=1}return s}catch{return{total:0,economy:0,staking:0,casino:0,security:0,system:0}}},[f,v]=o.useState(()=>w()),W="92b050b6fbe80695b5d56835e978918e37c8707a7fad09a01ae782d4c3170c9baa4c2c196b36eac6b78ceb210b287aeb0727ef1c60e48042142f7bcc8b6382305cd50c5a4542c44ec72a4de6640c194f8ef36bea1dbed168ab6fd8681d910d55",j=t=>{const s=(t==null?void 0:t.message)??String(t);return s==="passkey-prf-unsupported"?"This passkey/authenticator does not support the PRF/hmac-secret/largeBlob extensions required to derive a local vault key. Try creating the passkey on this device (platform passkey), or use a different authenticator (Android Chrome / hardware security key).":s},A=async()=>{r(null);const t=U();if(h(t.supported),B(t.enabled),k(t.unlocked),N(t.nullspacePublicKeyHex),!t.supported){a("Passkeys unavailable (requires secure context + WebAuthn)."),d(!1);return}try{const s=await ue();d(!!s),a(s?"Vault found":"No vault yet")}catch(s){d(!1),a("Failed to read vault"),r(j(s))}};o.useEffect(()=>{A()},[]),o.useEffect(()=>le(t=>{k(!!t),N((t==null?void 0:t.nullspacePublicKeyHex)??U().nullspacePublicKeyHex)}),[]);const Y=o.useMemo(()=>y?c?g?"UNLOCKED":"LOCKED":"NONE":"UNSUPPORTED",[y,c,g]),S=t=>{M(s=>[`${new Date().toLocaleTimeString()} ${t}`,...s].slice(0,20))},_=async()=>{r(null),a("Creating passkey + vault…");try{await ye({migrateExistingCasinoKey:!0}),a("Vault created and unlocked"),await A()}catch(t){a("Create failed"),r(j(t))}},q=async()=>{r(null),a("Unlocking…");try{await xe(),a("Unlocked"),await A()}catch(t){a("Unlock failed"),r(j(t))}},J=()=>{me(),a("Locked")},X=async()=>{var t;r(null),a("Deleting vault…");try{await he(),a("Vault deleted"),d(!1),k(!1),B(!1),N(null),(t=b.current)==null||t.stop(),b.current=null,T(!1)}catch(s){a("Delete failed"),r(j(s))}},Q=async()=>{r(null);const t=F();if(!t){r("Unlock your vault before starting the bot.");return}b.current||(b.current=new Te({baseUrl:"/api",identityHex:W,privateKeyBytes:t.nullspaceEd25519PrivateKey,onLog:S})),b.current.start(),T(!0),S("Vault bot started")},Z=()=>{var t;(t=b.current)==null||t.stop(),T(!1),S("Vault bot stopped")},ee=t=>{const s=!C[t];ge(t,s),I(u=>({...u,[t]:s})),x(`Flag updated: ${t} = ${s?"ON":"OFF"}`)},te=()=>{const t=!p;be(t),z(t),x(`Telemetry ${t?"enabled":"disabled"}`)},ae=async()=>{const t=pe(!0);try{await navigator.clipboard.writeText(t),x("Telemetry copied to clipboard")}catch{try{const s=new Blob([t],{type:"application/json"}),u=URL.createObjectURL(s),l=document.createElement("a");l.href=u,l.download=`nullspace-telemetry-${Date.now()}.json`,l.click(),URL.revokeObjectURL(u),x("Telemetry downloaded")}catch{x("Failed to export telemetry")}}finally{P(K().length)}};o.useEffect(()=>{if(E)return v(w()),fe(()=>v(w()))},[E]);const se=async()=>{const t=ke(!0);try{await navigator.clipboard.writeText(t),x("Activity copied to clipboard")}catch{try{const s=new Blob([t],{type:"application/json"}),u=URL.createObjectURL(s),l=document.createElement("a");l.href=u,l.download=`nullspace-activity-${Date.now()}.json`,l.click(),URL.revokeObjectURL(u),x("Activity downloaded")}catch{x("Failed to export activity")}}finally{v(w())}},re=()=>{Ne(),v(w()),x("Activity cleared")},ne=()=>{we(),P(0),x("Telemetry cleared")};return e.jsxs("div",{className:"min-h-screen w-screen bg-terminal-black text-white font-mono",children:[e.jsx(ve,{title:"Passkey Vault",status:R,leading:e.jsx(de,{})}),e.jsxs("div",{className:"max-w-4xl mx-auto p-4 space-y-4",children:[e.jsxs("div",{className:"border border-gray-800 rounded bg-gray-900/30 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"SECURITY"}),e.jsx("div",{className:"text-lg font-bold mt-1",children:"Passkey Vault"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["Vault: ",e.jsx("span",{className:"text-terminal-green",children:Y}),y?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-700",children:" · "}),"Enabled:"," ",e.jsx("span",{className:m?"text-terminal-green":"text-gray-500",children:m?"YES":"NO"})]}):null,L?e.jsxs(e.Fragment,{children:[" ","· Casino pubkey: ",e.jsxs("span",{className:"text-terminal-green",children:[L.slice(0,12),"…"]})]}):null]}),!1]}),e.jsxs("div",{className:"flex flex-col gap-2 items-end",children:[!c&&y&&e.jsx("button",{className:"text-[10px] border px-3 py-2 rounded bg-terminal-green/20 border-terminal-green text-terminal-green hover:bg-terminal-green/30",onClick:_,children:"CREATE PASSKEY VAULT"}),c&&!g&&e.jsx("button",{className:"text-[10px] border px-3 py-2 rounded bg-gray-900 border-gray-700 text-gray-200 hover:border-gray-500",onClick:q,children:"UNLOCK WITH PASSKEY"}),c&&g&&e.jsx("button",{className:"text-[10px] border px-3 py-2 rounded bg-gray-900 border-gray-700 text-gray-200 hover:border-gray-500",onClick:J,children:"LOCK VAULT"}),c&&e.jsx("button",{className:"text-[10px] border px-3 py-2 rounded bg-gray-900 border-gray-800 text-gray-400 hover:border-terminal-accent hover:text-terminal-accent",onClick:X,children:"DELETE VAULT"})]})]}),n&&e.jsx("div",{className:"mt-3 text-xs text-terminal-accent border border-terminal-accent/40 rounded bg-terminal-accent/10 p-2",children:n}),e.jsxs("div",{className:"mt-4 text-[10px] text-gray-500 leading-relaxed",children:["Passkeys unlock a local encrypted vault (stored in IndexedDB). The vault stores:",e.jsxs("ul",{className:"list-disc ml-5 mt-2 space-y-1 text-gray-500",children:[e.jsx("li",{children:"Casino betting key (ed25519) for onchain transactions"}),e.jsx("li",{children:"Chat key material (placeholder until XMTP integration)"})]}),e.jsxs("div",{className:"mt-2",children:["After unlocking, reload the app to ensure all pages pick up the vault-held keys.",e.jsx("button",{className:"ml-2 text-[10px] border px-2 py-1 rounded bg-gray-900 border-gray-800 text-gray-300 hover:border-gray-600",onClick:()=>window.location.reload(),children:"RELOAD"})]})]})]}),E&&e.jsxs("div",{className:"border border-gray-800 rounded bg-gray-900/30 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"DEV"}),e.jsx("div",{className:"text-sm font-bold mt-1",children:"Flags + Telemetry"}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Feature flags switch between new and legacy pages. Telemetry is stored locally (dev-only by default)."})]}),e.jsx("button",{className:"text-[10px] border px-3 py-2 rounded bg-gray-900 border-gray-700 text-gray-200 hover:border-gray-500",onClick:()=>window.location.reload(),children:"RELOAD"})]}),O?e.jsx("div",{className:"mt-3 text-[10px] text-gray-300 border border-gray-800 rounded bg-black/40 px-3 py-2",children:O}):null,e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"border border-gray-800 rounded bg-black/30 p-3",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest mb-2",children:"FEATURE FLAGS"}),e.jsx("div",{className:"space-y-2",children:[{key:"new_economy_ui",label:"New Economy UI (/swap, /borrow, /liquidity)"},{key:"new_staking_ui",label:"New Staking UI (/stake)"}].map(t=>e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"text-[11px] text-gray-400",children:t.label}),e.jsx("button",{type:"button",onClick:()=>ee(t.key),className:`text-[10px] px-2 py-1 rounded border ${C[t.key]?"border-terminal-green text-terminal-green":"border-gray-800 text-gray-500"}`,children:C[t.key]?"ON":"OFF"})]},t.key))}),e.jsx("div",{className:"mt-2 text-[10px] text-gray-600",children:"Tip: navigate away/back (or reload) to apply immediately."})]}),e.jsxs("div",{className:"border border-gray-800 rounded bg-black/30 p-3",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest mb-2",children:"TELEMETRY"}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-[11px] text-gray-400",children:["Enabled:"," ",e.jsx("span",{className:p?"text-terminal-green":"text-gray-500",children:p?"YES":"NO"}),e.jsx("span",{className:"text-gray-700",children:" · "}),"Events: ",e.jsx("span",{className:"text-white",children:G})]}),e.jsx("button",{type:"button",onClick:te,className:`text-[10px] px-2 py-1 rounded border ${p?"border-terminal-green text-terminal-green":"border-gray-800 text-gray-500"}`,children:p?"ON":"OFF"})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:ae,className:"text-[10px] border px-3 py-2 rounded bg-gray-900 border-gray-700 text-gray-200 hover:border-gray-500",children:"EXPORT JSON"}),e.jsx("button",{type:"button",onClick:ne,className:"text-[10px] border px-3 py-2 rounded bg-gray-900 border-gray-800 text-gray-400 hover:border-terminal-accent hover:text-terminal-accent",children:"CLEAR"})]}),e.jsx("div",{className:"mt-2 text-[10px] text-gray-600",children:"Export copies to clipboard when available; otherwise downloads a file."})]}),e.jsxs("div",{className:"border border-gray-800 rounded bg-black/30 p-3",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest mb-2",children:"ACTIVITY"}),e.jsxs("div",{className:"text-[11px] text-gray-400",children:["Total: ",e.jsx("span",{className:"text-white",children:f.total}),e.jsx("span",{className:"text-gray-700",children:" · "}),"Econ: ",e.jsx("span",{className:"text-white",children:f.economy}),e.jsx("span",{className:"text-gray-700",children:" · "}),"Stake: ",e.jsx("span",{className:"text-white",children:f.staking})]}),e.jsxs("div",{className:"text-[11px] text-gray-500 mt-1",children:["Casino: ",e.jsx("span",{className:"text-gray-300",children:f.casino}),e.jsx("span",{className:"text-gray-700",children:" · "}),"Security: ",e.jsx("span",{className:"text-gray-300",children:f.security})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:se,className:"text-[10px] border px-3 py-2 rounded bg-gray-900 border-gray-700 text-gray-200 hover:border-gray-500",children:"EXPORT JSON"}),e.jsx("button",{type:"button",onClick:re,className:"text-[10px] border px-3 py-2 rounded bg-gray-900 border-gray-800 text-gray-400 hover:border-terminal-accent hover:text-terminal-accent",children:"CLEAR"})]}),e.jsx("div",{className:"mt-2 text-[10px] text-gray-600",children:"Tracks pending/confirmed actions and links to receipts."})]})]})]}),e.jsxs("div",{className:"border border-gray-800 rounded bg-gray-900/30 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"POC"}),e.jsx("div",{className:"text-sm font-bold mt-1",children:"Vault Bot Bets"}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Uses the vault-held betting key to submit randomized casino games."})]}),e.jsx("div",{className:"flex items-center gap-2",children:$?e.jsx("button",{className:"text-[10px] border px-3 py-2 rounded bg-gray-900 border-gray-700 text-gray-200 hover:border-gray-500",onClick:Z,children:"STOP BOT"}):e.jsx("button",{className:`text-[10px] border px-3 py-2 rounded ${g?"bg-terminal-green/20 border-terminal-green text-terminal-green hover:bg-terminal-green/30":"bg-gray-900 border-gray-800 text-gray-500 cursor-not-allowed"}`,onClick:Q,disabled:!g,children:"START BOT"})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest mb-2",children:"LOGS"}),e.jsx("div",{className:"border border-gray-800 rounded bg-terminal-black/60 p-2 h-40 overflow-y-auto text-xs text-gray-300",children:V.length===0?e.jsx("div",{className:"text-gray-600",children:"No bot activity yet."}):V.map((t,s)=>e.jsx("div",{className:"whitespace-pre-wrap break-words",children:t},s))})]})]})]})]})}export{Ae as default};
