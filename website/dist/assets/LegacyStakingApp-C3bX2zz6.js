import{a as o,j as e,P as ee,c as te,C as ae}from"./index-mFzF45K3.js";function M(w){const b=w.trim();if(!b)return 0n;try{const y=BigInt(b);return y<0n?null:y}catch{return null}}function se(w,b=3){if(!Number.isFinite(w)||w<=0)return"0s";const y=Math.floor(w*b),u=Math.floor(y/60),j=Math.floor(u/60),k=Math.floor(j/24);return k>0?`~${k}d`:j>0?`~${j}h`:u>0?`~${u}m`:`~${y}s`}function ne(){const[w,b]=o.useState("Initializing…"),[y,u]=o.useState(null),[j,k]=o.useState([]),p=o.useRef(null),S=o.useRef(null),R=o.useRef(null),[C,$]=o.useState(!1),[f,L]=o.useState(null),[l,D]=o.useState(null),[s,K]=o.useState(null),[E,V]=o.useState(null),[T,U]=o.useState("Staker"),[A,F]=o.useState("0"),[B,G]=o.useState("100"),x=a=>{k(t=>[{ts:Date.now(),message:a},...t].slice(0,12))};o.useEffect(()=>((async()=>{try{const t="92b050b6fbe80695b5d56835e978918e37c8707a7fad09a01ae782d4c3170c9baa4c2c196b36eac6b78ceb210b287aeb0727ef1c60e48042142f7bcc8b6382305cd50c5a4542c44ec72a4de6640c194f8ef36bea1dbed168ab6fd8681d910d55",n=new te(t);await n.init();const c=new ae("/api",n);await c.init();const m=c.getOrCreateKeypair();if(!m){b("Unlock passkey vault (see Vault tab)."),x("Vault locked — unlock to continue");return}S.current=m.publicKey,R.current=m.publicKeyHex,p.current=c,await c.connectUpdates(m.publicKey);const N=await c.getAccount(m.publicKey);await c.initNonceManager(m.publicKeyHex,m.publicKey,N);const h=m.publicKeyHex.toLowerCase();c.onEvent("CasinoError",r=>{var i,g;((g=(i=r==null?void 0:r.player)==null?void 0:i.toLowerCase)==null?void 0:g.call(i))===h&&x(`ERROR: ${r.message??"Unknown error"}`)}),c.onEvent("Staked",r=>{var i,g;((g=(i=r==null?void 0:r.player)==null?void 0:i.toLowerCase)==null?void 0:g.call(i))===h&&x(`Staked: +${r.amount} (unlock @ ${r.unlockTs??r.unlock_ts??"—"})`)}),c.onEvent("Unstaked",r=>{var i,g;((g=(i=r==null?void 0:r.player)==null?void 0:i.toLowerCase)==null?void 0:g.call(i))===h&&x(`Unstaked: ${r.amount}`)}),c.onEvent("RewardsClaimed",r=>{var i,g;((g=(i=r==null?void 0:r.player)==null?void 0:i.toLowerCase)==null?void 0:g.call(i))===h&&x(`Rewards claimed: ${r.amount}`)}),c.onEvent("EpochProcessed",r=>{x(`Epoch processed: ${r.epoch}`)}),b("Connected"),x("Connected")}catch{b("Failed to connect. Check simulator + dev-executor.")}})(),()=>{var n;const t=p.current;try{(n=t==null?void 0:t.destroy)==null||n.call(t)}catch{}p.current=null,S.current=null,R.current=null}),[]),o.useEffect(()=>{const a=setInterval(async()=>{var c;const t=p.current,n=S.current;if(!(!t||!n))try{const[m,N,h]=await Promise.all([t.getCasinoPlayer(n),t.getStaker(n),t.getHouse()]);L(m),$(!!m),D(N),K(h),V(((c=t.getCurrentView)==null?void 0:c.call(t))??null)}catch{}},1e3);return()=>clearInterval(a)},[]);const d=o.useMemo(()=>{const a=BigInt((l==null?void 0:l.balance)??0),t=Number((l==null?void 0:l.unlockTs)??0),n=BigInt((l==null?void 0:l.votingPower)??0),c=BigInt((l==null?void 0:l.unclaimedRewards)??0),m=BigInt((l==null?void 0:l.rewardDebtX18)??0),N=BigInt((s==null?void 0:s.totalVotingPower)??0),h=BigInt((s==null?void 0:s.totalStakedAmount)??0),r=BigInt((s==null?void 0:s.stakingRewardPerVotingPowerX18)??0),i=BigInt((s==null?void 0:s.stakingRewardPool)??0),g=E??0,H=t>0&&g<t,z=H?t-g:0,q=N>0n?Number(n*10000n/N):0,J=h>0n?Number(a*10000n/h):0,Q=1000000000000000000n;let P=0n;if(n>0n){const I=n*r;P=I>m?(I-m)/Q:0n}const Z=c+P;return{staked:a,unlockTs:t,vp:n,unclaimedRewards:c,pendingRewards:P,claimableRewards:Z,totalVp:N,totalStaked:h,locked:H,remainingBlocks:z,shareBps:q,stakedShareBps:J,rewardPool:i}},[l,s,E]),v=async()=>{const a=p.current;if(!(a!=null&&a.nonceManager))throw new Error("Client not ready");if(C)return;const t=T.trim()||`Staker_${Date.now().toString(36)}`,n=await a.nonceManager.submitCasinoRegister(t);n!=null&&n.txHash&&u(n.txHash),x(`Submitted register (${t})`)},O=async()=>{const a=p.current;if(!(a!=null&&a.nonceManager))throw new Error("Client not ready");await v();const t=await a.nonceManager.submitCasinoDeposit(1e3);t!=null&&t.txHash&&u(t.txHash),x("Submitted faucet claim (1000 RNG)")},W=async()=>{const a=p.current;if(!(a!=null&&a.nonceManager))throw new Error("Client not ready");await v();const t=M(A),n=M(B);if(t===null||n===null){x("Invalid stake amount/duration");return}const c=await a.nonceManager.submitStake(t.toString(),n.toString());c!=null&&c.txHash&&u(c.txHash),x(`Submitted stake (amount=${t}, duration=${n})`)},X=async()=>{const a=p.current;if(!(a!=null&&a.nonceManager))throw new Error("Client not ready");await v();const t=await a.nonceManager.submitUnstake();t!=null&&t.txHash&&u(t.txHash),x("Submitted unstake")},_=async()=>{const a=p.current;if(!(a!=null&&a.nonceManager))throw new Error("Client not ready");await v();const t=await a.nonceManager.submitClaimRewards();t!=null&&t.txHash&&u(t.txHash),x("Submitted claim rewards")},Y=async()=>{const a=p.current;if(!(a!=null&&a.nonceManager))throw new Error("Client not ready");await v();const t=await a.nonceManager.submitProcessEpoch();t!=null&&t.txHash&&u(t.txHash),x("Submitted process epoch")};return e.jsxs("div",{className:"min-h-screen bg-terminal-black text-white font-mono p-4",children:[e.jsxs("header",{className:"flex flex-wrap items-center justify-between gap-3 border-b border-gray-800 pb-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx(ee,{}),e.jsx("div",{className:"text-lg font-bold tracking-widest",children:"Staking"}),e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:w})]}),e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:y?`LAST TX: ${y}`:null})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("section",{className:"border border-gray-800 rounded p-4 bg-gray-900/30",children:[e.jsx("div",{className:"text-xs text-gray-400 tracking-widest mb-3",children:"WALLET"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:["Registered:"," ",e.jsx("span",{className:C?"text-terminal-green":"text-terminal-accent",children:C?"YES":"NO"})]}),e.jsxs("div",{children:["RNG: ",e.jsx("span",{className:"text-white",children:(f==null?void 0:f.chips)??0})]}),e.jsxs("div",{children:["vUSDT: ",e.jsx("span",{className:"text-white",children:(f==null?void 0:f.vusdtBalance)??0})]}),e.jsxs("div",{className:"text-[10px] text-gray-600 break-all",children:["PK: ",R.current??"—"]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"flex-1 bg-gray-950 border border-gray-800 rounded px-2 py-1 text-xs",value:T,onChange:a=>U(a.target.value),placeholder:"Name"}),e.jsx("button",{className:"text-xs px-3 py-1 rounded border border-terminal-green text-terminal-green hover:bg-terminal-green/10",onClick:v,children:"Register"})]}),e.jsx("button",{className:"w-full text-xs px-3 py-2 rounded border border-terminal-green text-terminal-green hover:bg-terminal-green/10",onClick:O,children:"Daily Faucet (1000 RNG)"})]})]}),e.jsxs("section",{className:"border border-gray-800 rounded p-4 bg-gray-900/30",children:[e.jsx("div",{className:"text-xs text-gray-400 tracking-widest mb-3",children:"STAKE RNG"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"border border-gray-800 rounded p-3 bg-black/30",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"YOUR STAKE"}),e.jsx("div",{className:"text-white mt-1",children:(l==null?void 0:l.balance)??0}),e.jsxs("div",{className:"text-[10px] text-gray-600",children:["unlock @ ",d.unlockTs||"—"]}),e.jsxs("div",{className:"text-[10px] text-gray-600",children:["unclaimed ",d.unclaimedRewards.toString()]})]}),e.jsxs("div",{className:"border border-gray-800 rounded p-3 bg-black/30",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"VOTING POWER"}),e.jsx("div",{className:"text-white mt-1",children:d.vp.toString()}),e.jsxs("div",{className:"text-[10px] text-gray-600",children:["share ~ ",(d.shareBps/100).toFixed(2),"%"]}),e.jsxs("div",{className:"text-[10px] text-gray-600",children:["claimable ",d.claimableRewards.toString()]})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{className:"bg-gray-950 border border-gray-800 rounded px-2 py-1 text-xs",value:A,onChange:a=>F(a.target.value),placeholder:"Amount (RNG)"}),e.jsx("input",{className:"bg-gray-950 border border-gray-800 rounded px-2 py-1 text-xs",value:B,onChange:a=>G(a.target.value),placeholder:"Duration (blocks)"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{className:"flex-1 text-xs px-3 py-2 rounded border border-terminal-green text-terminal-green hover:bg-terminal-green/10",onClick:W,children:"Stake"}),e.jsx("button",{className:`text-xs px-3 py-2 rounded border ${d.locked?"border-gray-800 text-gray-600 cursor-not-allowed":"border-gray-700 text-gray-300 hover:border-gray-500"}`,onClick:X,disabled:d.locked,title:d.locked?`Locked for ${d.remainingBlocks} blocks`:"Unstake",children:"Unstake"}),e.jsx("button",{className:`text-xs px-3 py-2 rounded border ${d.claimableRewards===0n?"border-gray-800 text-gray-600 cursor-not-allowed":"border-gray-700 text-gray-300 hover:border-gray-500"}`,onClick:_,disabled:d.claimableRewards===0n,title:d.claimableRewards===0n?"No rewards to claim":"Claim rewards",children:"Claim"})]}),d.locked&&e.jsxs("div",{className:"text-[10px] text-gray-500",children:["Locked: ",d.remainingBlocks," blocks (",se(d.remainingBlocks),")"]}),e.jsx("div",{className:"text-[10px] text-gray-600 leading-relaxed",children:"Rewards are funded from positive epoch net PnL and distributed pro-rata by voting power (amount * duration). Call “Process Epoch” after ~100 blocks to roll the epoch and update the reward pool."})]})]}),e.jsxs("section",{className:"border border-gray-800 rounded p-4 bg-gray-900/30",children:[e.jsx("div",{className:"text-xs text-gray-400 tracking-widest mb-3",children:"HOUSE / REWARDS"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Epoch"}),e.jsx("span",{className:"text-white",children:(s==null?void 0:s.currentEpoch)??0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Net PnL"}),e.jsx("span",{className:"text-white",children:(s==null?void 0:s.netPnl)??"0"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Total Staked"}),e.jsx("span",{className:"text-white",children:(s==null?void 0:s.totalStakedAmount)??0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Total Voting Power"}),e.jsx("span",{className:"text-white",children:(s==null?void 0:s.totalVotingPower)??"0"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"AMM Fees"}),e.jsx("span",{className:"text-white",children:(s==null?void 0:s.accumulatedFees)??0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Total Burned"}),e.jsx("span",{className:"text-white",children:(s==null?void 0:s.totalBurned)??0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Total Issuance"}),e.jsx("span",{className:"text-white",children:(s==null?void 0:s.totalIssuance)??0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Reward Pool"}),e.jsx("span",{className:"text-white",children:d.rewardPool.toString()})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Reward Carry"}),e.jsx("span",{className:"text-white",children:(s==null?void 0:s.stakingRewardCarry)??0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"View"}),e.jsx("span",{className:"text-white",children:E??"—"})]})]}),e.jsxs("div",{className:"mt-4 border-t border-gray-800 pt-4 space-y-2",children:[e.jsx("button",{className:"w-full text-xs px-3 py-2 rounded border border-gray-700 text-gray-300 hover:border-gray-500",onClick:Y,children:"Process Epoch (dev)"}),e.jsx("div",{className:"text-[10px] text-gray-600",children:"Anyone can call this in dev; later it’s a keeper/admin action."})]})]})]}),e.jsxs("section",{className:"mt-4 border border-gray-800 rounded p-4 bg-gray-900/20",children:[e.jsx("div",{className:"text-xs text-gray-400 tracking-widest mb-3",children:"ACTIVITY"}),j.length===0?e.jsx("div",{className:"text-[10px] text-gray-600",children:"No activity yet."}):e.jsx("ul",{className:"space-y-1 text-[10px] text-gray-400",children:j.map(a=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-gray-600",children:new Date(a.ts).toLocaleTimeString()}),e.jsx("span",{className:"text-gray-300",children:a.message})]},a.ts))})]})]})}export{ne as default};
