import{c as ie,a as c,d as S,e as oe,i as ce,f as K,s as le,j as e,P as de,h as ue,k as ye,l as xe,m as me,n as he,o as F,q as ge,v as be,w as pe,x as we}from"./index-mFzF45K3.js";import{s as fe,P as ve,g as je,e as ke,c as Ne}from"./txTracker-BOjY1mwg.js";const D={betIntervalMs:2500,randomizeInterval:!0,betAmount:10},i={Baccarat:0,Blackjack:1,CasinoWar:2,Craps:3,VideoPoker:4,HiLo:5,Roulette:6,SicBo:7,ThreeCard:8,UltimateHoldem:9},H=[i.Baccarat,i.Blackjack,i.CasinoWar,i.Craps,i.VideoPoker,i.HiLo,i.Roulette,i.SicBo,i.ThreeCard,i.UltimateHoldem];class Te{constructor(t){this.wasm=null,this.nonce=0,this.sessionCounter=Date.now(),this.isRunning=!1,this.timer=null,this.config=D,this.baseUrl=t.baseUrl,this.identityHex=t.identityHex,this.privateKeyBytes=t.privateKeyBytes,this.onLog=t.onLog,this.config={...D,...t.config??{}}}log(t){var s;try{(s=this.onLog)==null||s.call(this,t)}catch{}}async init(){if(this.wasm)return;const t=new ie(this.identityHex);await t.init(),t.createKeypair(this.privateKeyBytes),this.wasm=t,await this.resyncNonce(),await this.ensureRegistered(),this.log(`Vault bot ready (pubkey=${t.getPublicKeyHex().slice(0,8)}…) nonce=${this.nonce}`)}start(){this.isRunning||(this.isRunning=!0,this.loop())}stop(){this.isRunning=!1,this.timer!==null&&(clearTimeout(this.timer),this.timer=null)}setConfig(t){this.config={...this.config,...t}}getRunning(){return this.isRunning}scheduleNext(){if(!this.isRunning)return;const t=this.config.randomizeInterval?Math.floor(this.config.betIntervalMs*(.5+Math.random())):this.config.betIntervalMs;this.timer=window.setTimeout(()=>void this.loop(),t)}async loop(){if(this.isRunning)try{await this.init(),await this.playRandomGame()}catch(t){this.log(`Vault bot error: ${(t==null?void 0:t.message)??String(t)}`);try{await this.resyncNonce()}catch{}}finally{this.scheduleNext()}}async submitTransaction(t){if(!this.wasm)throw new Error("bot-not-initialized");const s=this.wasm.wrapTransactionSubmission(t),r=await fetch(`${this.baseUrl}/submit`,{method:"POST",headers:{"Content-Type":"application/octet-stream"},body:s});if(!r.ok)throw new Error(`submit-failed:${r.status}`)}async getAccountState(t){if(!this.wasm)throw new Error("bot-not-initialized");const s=this.wasm.encodeAccountKey(t),r=this.wasm.hashKey(s),o=this.wasm.bytesToHex(r),d=await fetch(`${this.baseUrl}/state/${o}`);if(d.status===404)return null;if(!d.ok)throw new Error(`state-query-failed:${d.status}`);const y=await d.arrayBuffer(),h=new Uint8Array(y);if(h.length===0)return null;const m=this.wasm.decodeLookup(h);return m&&m.type==="Account"?{nonce:m.nonce}:null}async resyncNonce(){if(!this.wasm)throw new Error("bot-not-initialized");const t=this.wasm.getPublicKeyBytes(),s=await this.getAccountState(t);this.nonce=(s==null?void 0:s.nonce)??0}async ensureRegistered(){if(!this.wasm)throw new Error("bot-not-initialized");if(this.nonce!==0)return;const t=`Vault_${Date.now().toString(36)}`,s=this.wasm.createCasinoRegisterTransaction(this.nonce,t);try{await this.submitTransaction(s),this.nonce+=1,this.log(`Registered as ${t}`)}catch{await this.resyncNonce()}}async playRandomGame(){if(!this.wasm)throw new Error("bot-not-initialized");const t=H[Math.floor(Math.random()*H.length)],s=BigInt(++this.sessionCounter),r=this.config.betAmount,o=this.nonce,d=this.wasm.createCasinoStartGameTransaction(o,t,r,s);try{await this.submitTransaction(d),this.nonce++}catch{await this.resyncNonce();return}await new Promise(y=>setTimeout(y,25));for(const y of this.getGameMoves(t)){const h=this.wasm.createCasinoGameMoveTransaction(this.nonce,s,y);try{await this.submitTransaction(h),this.nonce++,await new Promise(m=>setTimeout(m,10))}catch{await this.resyncNonce();break}}}getGameMoves(t){switch(t){case i.Baccarat:return[this.serializeBaccaratAtomicBatch([{betType:Math.floor(Math.random()*3),amount:this.config.betAmount}])];case i.Blackjack:return[new Uint8Array([1])];case i.CasinoWar:return[];case i.Craps:return[this.serializeCrapsBet(0,0,this.config.betAmount),new Uint8Array([2])];case i.VideoPoker:return[new Uint8Array([31])];case i.HiLo:return[new Uint8Array([Math.floor(Math.random()*2)])];case i.Roulette:return[new Uint8Array([1,0])];case i.SicBo:return[new Uint8Array([0,0])];case i.ThreeCard:return[new Uint8Array([0])];case i.UltimateHoldem:return[new Uint8Array([0]),new Uint8Array([4])];default:return[]}}serializeBaccaratBet(t,s){const r=new Uint8Array(10);return r[0]=0,r[1]=t,new DataView(r.buffer).setBigUint64(2,BigInt(s),!1),r}serializeBaccaratAtomicBatch(t){const s=new Uint8Array(2+t.length*9);s[0]=3,s[1]=t.length;let r=2;for(const o of t)s[r]=o.betType,new DataView(s.buffer).setBigUint64(r+1,BigInt(o.amount),!1),r+=9;return s}serializeCrapsBet(t,s,r){const o=new Uint8Array(11);return o[0]=0,o[1]=t,o[2]=s,new DataView(o.buffer).setBigUint64(3,BigInt(r),!1),o}}function Ae(){const[B,t]=c.useState("Loading…"),[s,r]=c.useState(null),[o,d]=c.useState(!1),[y,h]=c.useState(!1),[m,R]=c.useState(!1),[g,k]=c.useState(!!F()),[L,N]=c.useState(S().nullspacePublicKeyHex),[$,T]=c.useState(!1),[V,M]=c.useState([]),b=c.useRef(null),E=(()=>{try{return!1}catch{return!1}})(),[C,I]=c.useState(()=>oe()),[p,z]=c.useState(()=>ce()),[G,P]=c.useState(()=>K().length),[O,x]=c.useState(null),w=()=>{try{const a=je(),n={total:a.length,economy:0,staking:0,casino:0,security:0,system:0};for(const u of a){const l=u==null?void 0:u.surface;l==="economy"?n.economy+=1:l==="staking"?n.staking+=1:l==="casino"?n.casino+=1:l==="security"?n.security+=1:n.system+=1}return n}catch{return{total:0,economy:0,staking:0,casino:0,security:0,system:0}}},[f,v]=c.useState(()=>w()),W="92b050b6fbe80695b5d56835e978918e37c8707a7fad09a01ae782d4c3170c9baa4c2c196b36eac6b78ceb210b287aeb0727ef1c60e48042142f7bcc8b6382305cd50c5a4542c44ec72a4de6640c194f8ef36bea1dbed168ab6fd8681d910d55",j=a=>{const n=(a==null?void 0:a.message)??String(a);return n==="passkey-prf-unsupported"?"This passkey/authenticator does not support the PRF/hmac-secret/largeBlob extensions required to derive a local vault key. Try creating the passkey on this device (platform passkey), or use a different authenticator (Android Chrome / hardware security key).":n},A=async()=>{r(null);const a=S();if(h(a.supported),R(a.enabled),k(a.unlocked),N(a.nullspacePublicKeyHex),!a.supported){t("Passkeys unavailable (requires secure context + WebAuthn)."),d(!1);return}try{const n=await ue();d(!!n),t(n?"Vault found":"No vault yet")}catch(n){d(!1),t("Failed to read vault"),r(j(n))}};c.useEffect(()=>{A()},[]),c.useEffect(()=>le(a=>{k(!!a),N((a==null?void 0:a.nullspacePublicKeyHex)??S().nullspacePublicKeyHex)}),[]);const Y=c.useMemo(()=>y?o?g?"UNLOCKED":"LOCKED":"NONE":"UNSUPPORTED",[y,o,g]),U=a=>{M(n=>[`${new Date().toLocaleTimeString()} ${a}`,...n].slice(0,20))},_=async()=>{r(null),t("Creating passkey + vault…");try{await ye({migrateExistingCasinoKey:!0}),t("Vault created and unlocked"),await A()}catch(a){t("Create failed"),r(j(a))}},q=async()=>{r(null),t("Unlocking…");try{await xe(),t("Unlocked"),await A()}catch(a){t("Unlock failed"),r(j(a))}},J=()=>{me(),t("Locked")},X=async()=>{var a;r(null),t("Deleting vault…");try{await he(),t("Vault deleted"),d(!1),k(!1),R(!1),N(null),(a=b.current)==null||a.stop(),b.current=null,T(!1)}catch(n){t("Delete failed"),r(j(n))}},Q=async()=>{r(null);const a=F();if(!a){r("Unlock your vault before starting the bot.");return}b.current||(b.current=new Te({baseUrl:"/api",identityHex:W,privateKeyBytes:a.nullspaceEd25519PrivateKey,onLog:U})),b.current.start(),T(!0),U("Vault bot started")},Z=()=>{var a;(a=b.current)==null||a.stop(),T(!1),U("Vault bot stopped")},ee=a=>{const n=!C[a];ge(a,n),I(u=>({...u,[a]:n})),x(`Flag updated: ${a} = ${n?"ON":"OFF"}`)},te=()=>{const a=!p;be(a),z(a),x(`Telemetry ${a?"enabled":"disabled"}`)},ae=async()=>{const a=pe(!0);try{await navigator.clipboard.writeText(a),x("Telemetry copied to clipboard")}catch{try{const n=new Blob([a],{type:"application/json"}),u=URL.createObjectURL(n),l=document.createElement("a");l.href=u,l.download=`nullspace-telemetry-${Date.now()}.json`,l.click(),URL.revokeObjectURL(u),x("Telemetry downloaded")}catch{x("Failed to export telemetry")}}finally{P(K().length)}};c.useEffect(()=>{if(E)return v(w()),fe(()=>v(w()))},[E]);const se=async()=>{const a=ke(!0);try{await navigator.clipboard.writeText(a),x("Activity copied to clipboard")}catch{try{const n=new Blob([a],{type:"application/json"}),u=URL.createObjectURL(n),l=document.createElement("a");l.href=u,l.download=`nullspace-activity-${Date.now()}.json`,l.click(),URL.revokeObjectURL(u),x("Activity downloaded")}catch{x("Failed to export activity")}}finally{v(w())}},re=()=>{Ne(),v(w()),x("Activity cleared")},ne=()=>{we(),P(0),x("Telemetry cleared")};return e.jsxs("div",{className:"min-h-screen w-screen bg-terminal-black text-white font-mono",children:[e.jsx(ve,{title:"Passkey Vault",status:B,leading:e.jsx(de,{})}),e.jsxs("div",{className:"max-w-4xl mx-auto p-4 space-y-4",children:[e.jsxs("div",{className:"border border-gray-800 rounded bg-gray-900/30 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"SECURITY"}),e.jsx("div",{className:"text-lg font-bold mt-1",children:"Passkey Vault"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["Vault: ",e.jsx("span",{className:"text-terminal-green",children:Y}),y?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-700",children:" · "}),"Enabled:"," ",e.jsx("span",{className:m?"text-terminal-green":"text-gray-500",children:m?"YES":"NO"})]}):null,L?e.jsxs(e.Fragment,{children:[" ","· Casino pubkey: ",e.jsxs("span",{className:"text-terminal-green",children:[L.slice(0,12),"…"]})]}):null]}),!1]}),e.jsxs("div",{className:"flex flex-col gap-2 items-end",children:[!o&&y&&e.jsx("button",{className:"text-[10px] border px-3 py-2 rounded bg-terminal-green/20 border-terminal-green text-terminal-green hover:bg-terminal-green/30",onClick:_,children:"CREATE PASSKEY VAULT"}),o&&!g&&e.jsx("button",{className:"text-[10px] border px-3 py-2 rounded bg-gray-900 border-gray-700 text-gray-200 hover:border-gray-500",onClick:q,children:"UNLOCK WITH PASSKEY"}),o&&g&&e.jsx("button",{className:"text-[10px] border px-3 py-2 rounded bg-gray-900 border-gray-700 text-gray-200 hover:border-gray-500",onClick:J,children:"LOCK VAULT"}),o&&e.jsx("button",{className:"text-[10px] border px-3 py-2 rounded bg-gray-900 border-gray-800 text-gray-400 hover:border-terminal-accent hover:text-terminal-accent",onClick:X,children:"DELETE VAULT"})]})]}),s&&e.jsx("div",{className:"mt-3 text-xs text-terminal-accent border border-terminal-accent/40 rounded bg-terminal-accent/10 p-2",children:s}),e.jsxs("div",{className:"mt-4 text-[10px] text-gray-500 leading-relaxed",children:["Passkeys unlock a local encrypted vault (stored in IndexedDB). The vault stores:",e.jsxs("ul",{className:"list-disc ml-5 mt-2 space-y-1 text-gray-500",children:[e.jsx("li",{children:"Casino betting key (ed25519) for onchain transactions"}),e.jsx("li",{children:"Chat key material (placeholder until XMTP integration)"})]}),e.jsxs("div",{className:"mt-2",children:["After unlocking, reload the app to ensure all pages pick up the vault-held keys.",e.jsx("button",{className:"ml-2 text-[10px] border px-2 py-1 rounded bg-gray-900 border-gray-800 text-gray-300 hover:border-gray-600",onClick:()=>window.location.reload(),children:"RELOAD"})]})]})]}),E&&e.jsxs("div",{className:"border border-gray-800 rounded bg-gray-900/30 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"DEV"}),e.jsx("div",{className:"text-sm font-bold mt-1",children:"Flags + Telemetry"}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Feature flags switch between new and legacy pages. Telemetry is stored locally (dev-only by default)."})]}),e.jsx("button",{className:"text-[10px] border px-3 py-2 rounded bg-gray-900 border-gray-700 text-gray-200 hover:border-gray-500",onClick:()=>window.location.reload(),children:"RELOAD"})]}),O?e.jsx("div",{className:"mt-3 text-[10px] text-gray-300 border border-gray-800 rounded bg-black/40 px-3 py-2",children:O}):null,e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"border border-gray-800 rounded bg-black/30 p-3",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest mb-2",children:"FEATURE FLAGS"}),e.jsx("div",{className:"space-y-2",children:[{key:"new_economy_ui",label:"New Economy UI (/swap, /borrow, /liquidity)"},{key:"new_staking_ui",label:"New Staking UI (/stake)"}].map(a=>e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"text-[11px] text-gray-400",children:a.label}),e.jsx("button",{type:"button",onClick:()=>ee(a.key),className:`text-[10px] px-2 py-1 rounded border ${C[a.key]?"border-terminal-green text-terminal-green":"border-gray-800 text-gray-500"}`,children:C[a.key]?"ON":"OFF"})]},a.key))}),e.jsx("div",{className:"mt-2 text-[10px] text-gray-600",children:"Tip: navigate away/back (or reload) to apply immediately."})]}),e.jsxs("div",{className:"border border-gray-800 rounded bg-black/30 p-3",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest mb-2",children:"TELEMETRY"}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-[11px] text-gray-400",children:["Enabled:"," ",e.jsx("span",{className:p?"text-terminal-green":"text-gray-500",children:p?"YES":"NO"}),e.jsx("span",{className:"text-gray-700",children:" · "}),"Events: ",e.jsx("span",{className:"text-white",children:G})]}),e.jsx("button",{type:"button",onClick:te,className:`text-[10px] px-2 py-1 rounded border ${p?"border-terminal-green text-terminal-green":"border-gray-800 text-gray-500"}`,children:p?"ON":"OFF"})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:ae,className:"text-[10px] border px-3 py-2 rounded bg-gray-900 border-gray-700 text-gray-200 hover:border-gray-500",children:"EXPORT JSON"}),e.jsx("button",{type:"button",onClick:ne,className:"text-[10px] border px-3 py-2 rounded bg-gray-900 border-gray-800 text-gray-400 hover:border-terminal-accent hover:text-terminal-accent",children:"CLEAR"})]}),e.jsx("div",{className:"mt-2 text-[10px] text-gray-600",children:"Export copies to clipboard when available; otherwise downloads a file."})]}),e.jsxs("div",{className:"border border-gray-800 rounded bg-black/30 p-3",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest mb-2",children:"ACTIVITY"}),e.jsxs("div",{className:"text-[11px] text-gray-400",children:["Total: ",e.jsx("span",{className:"text-white",children:f.total}),e.jsx("span",{className:"text-gray-700",children:" · "}),"Econ: ",e.jsx("span",{className:"text-white",children:f.economy}),e.jsx("span",{className:"text-gray-700",children:" · "}),"Stake: ",e.jsx("span",{className:"text-white",children:f.staking})]}),e.jsxs("div",{className:"text-[11px] text-gray-500 mt-1",children:["Casino: ",e.jsx("span",{className:"text-gray-300",children:f.casino}),e.jsx("span",{className:"text-gray-700",children:" · "}),"Security: ",e.jsx("span",{className:"text-gray-300",children:f.security})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:se,className:"text-[10px] border px-3 py-2 rounded bg-gray-900 border-gray-700 text-gray-200 hover:border-gray-500",children:"EXPORT JSON"}),e.jsx("button",{type:"button",onClick:re,className:"text-[10px] border px-3 py-2 rounded bg-gray-900 border-gray-800 text-gray-400 hover:border-terminal-accent hover:text-terminal-accent",children:"CLEAR"})]}),e.jsx("div",{className:"mt-2 text-[10px] text-gray-600",children:"Tracks pending/confirmed actions and links to receipts."})]})]})]}),e.jsxs("div",{className:"border border-gray-800 rounded bg-gray-900/30 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest",children:"POC"}),e.jsx("div",{className:"text-sm font-bold mt-1",children:"Vault Bot Bets"}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Uses the vault-held betting key to submit randomized casino games."})]}),e.jsx("div",{className:"flex items-center gap-2",children:$?e.jsx("button",{className:"text-[10px] border px-3 py-2 rounded bg-gray-900 border-gray-700 text-gray-200 hover:border-gray-500",onClick:Z,children:"STOP BOT"}):e.jsx("button",{className:`text-[10px] border px-3 py-2 rounded ${g?"bg-terminal-green/20 border-terminal-green text-terminal-green hover:bg-terminal-green/30":"bg-gray-900 border-gray-800 text-gray-500 cursor-not-allowed"}`,onClick:Q,disabled:!g,children:"START BOT"})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-[10px] text-gray-500 tracking-widest mb-2",children:"LOGS"}),e.jsx("div",{className:"border border-gray-800 rounded bg-terminal-black/60 p-2 h-40 overflow-y-auto text-xs text-gray-300",children:V.length===0?e.jsx("div",{className:"text-gray-600",children:"No bot activity yet."}):V.map((a,n)=>e.jsx("div",{className:"whitespace-pre-wrap break-words",children:a},n))})]})]})]})]})}export{Ae as default};
